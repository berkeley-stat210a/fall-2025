<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Will Fithian">

<title>Sufficiency</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-7b1b06e26e1e2798ccde3208f86b5bbd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-B8G2041HSB"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-B8G2041HSB', { 'anonymize_ip': true});
</script>
<script type="module" src="../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
<script async="" src="https://siteimproveanalytics.com/js/siteanalyze_6294756.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../assets/styles.css">
</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../reader/introduction.html">Course Reader</a></li><li class="breadcrumb-item"><a href="../reader/sufficiency.html">Sufficiency</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../assets/stat_bear.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Stat 210a</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/berkeley-stat210a/fall-2025" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home / Schedule</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Course Logistics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../faq.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Frequently Asked Questions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../calendar.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Calendar</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Course Materials</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../handwritten-notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Handwritten notes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../homework.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Homework</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../old-exams.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Old exams</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Course Reader</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../reader/introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../reader/probability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../reader/estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Statistical models and estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../reader/exponential-families.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exponential Families</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../reader/sufficiency.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Sufficiency</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../reader/completeness.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Completeness, Ancillarity, and Basu’s Theorem</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../reader/unbiased-estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Unbiased Estimation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../license.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">License</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#sufficiency" id="toc-sufficiency" class="nav-link active" data-scroll-target="#sufficiency">Sufficiency</a></li>
  <li><a href="#visualization-of-sufficiency" id="toc-visualization-of-sufficiency" class="nav-link" data-scroll-target="#visualization-of-sufficiency">Visualization of sufficiency</a></li>
  <li><a href="#factorization-theorem" id="toc-factorization-theorem" class="nav-link" data-scroll-target="#factorization-theorem">Factorization theorem</a></li>
  <li><a href="#statement-for-general-mathcalx" id="toc-statement-for-general-mathcalx" class="nav-link" data-scroll-target="#statement-for-general-mathcalx">Statement for general <span class="math inline">\(\mathcal{X}\)</span></a></li>
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples">Examples</a></li>
  <li><a href="#interpretations-of-sufficiency" id="toc-interpretations-of-sufficiency" class="nav-link" data-scroll-target="#interpretations-of-sufficiency">Interpretations of sufficiency</a></li>
  <li><a href="#sufficient-statistics-under-i.i.d.-sampling" id="toc-sufficient-statistics-under-i.i.d.-sampling" class="nav-link" data-scroll-target="#sufficient-statistics-under-i.i.d.-sampling">Sufficient statistics under i.i.d. sampling</a></li>
  <li><a href="#minimal-sufficiency" id="toc-minimal-sufficiency" class="nav-link" data-scroll-target="#minimal-sufficiency">Minimal sufficiency</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../reader/introduction.html">Course Reader</a></li><li class="breadcrumb-item"><a href="../reader/sufficiency.html">Sufficiency</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Sufficiency</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Will Fithian </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<p><span class="math display">\[
\newcommand{\cB}{\mathcal{B}}
\newcommand{\cF}{\mathcal{F}}
\newcommand{\cN}{\mathcal{N}}
\newcommand{\cP}{\mathcal{P}}
\newcommand{\cX}{\mathcal{X}}
\newcommand{\EE}{\mathbb{E}}
\newcommand{\PP}{\mathbb{P}}
\newcommand{\RR}{\mathbb{R}}
\newcommand{\ZZ}{\mathbb{Z}}
\newcommand{\td}{\,\textrm{d}}
\newcommand{\simiid}{\stackrel{\textrm{i.i.d.}}{\sim}}
\newcommand{\simind}{\stackrel{\textrm{ind.}}{\sim}}
\newcommand{\eqas}{\stackrel{\textrm{a.s.}}{=}}
\newcommand{\eqPas}{\stackrel{\cP\textrm{-a.s.}}{=}}
\newcommand{\eqmuas}{\stackrel{\mu\textrm{-a.s.}}{=}}
\newcommand{\eqD}{\stackrel{D}{=}}
\newcommand{\indep}{\perp\!\!\!\!\perp}
\DeclareMathOperator*{\minz}{minimize\;}
\DeclareMathOperator*{\maxz}{minimize\;}
\DeclareMathOperator*{\argmin}{argmin\;}
\DeclareMathOperator*{\argmax}{argmax\;}
\newcommand{\Var}{\textnormal{Var}}
\newcommand{\Cov}{\textnormal{Cov}}
\newcommand{\Corr}{\textnormal{Corr}}
\]</span></p>
<section id="sufficiency" class="level2">
<h2 class="anchored" data-anchor-id="sufficiency">Sufficiency</h2>
<p>Sufficiency is a central concept in statistics that allows us to focus on the essential aspects of the data set while ignoring details that are irrelevant to the inference problem. If <span class="math inline">\(X\sim P_\theta\)</span> represents the entire data set, drawn from a model <span class="math inline">\(\cP = \{P_\theta:\; \theta \in \Theta\}\)</span>, then this lecture will concern the idea of a <em>sufficient statistic</em> <span class="math inline">\(T(X)\)</span> that carries all of the information in the data that can help us learn about <span class="math inline">\(\theta\)</span>.</p>
<p>A <em>statistic</em> <span class="math inline">\(T(X)\)</span> is any random variable which is a function of the data <span class="math inline">\(X\)</span>, and which does <strong>not</strong> depend on the unknown parameter <span class="math inline">\(\theta\)</span>. We say the statistic <span class="math inline">\(T(X)\)</span> is <em>sufficient</em> for the model <span class="math inline">\(\cP\)</span> if <span class="math inline">\(P_\theta(X \mid T)\)</span> does not depend on <span class="math inline">\(\theta\)</span>. This lecture will be devoted to interpreting this definition and giving examples.</p>
<p><strong>Example (Independent Bernoulli sequence):</strong> We introduced the binomial example from Lecture 2 by telling a story about an investigator who flips a biased coin <span class="math inline">\(n\)</span> times and records the total number of heads, which has a binomial distribution. All of the estimators we considered were functions only of the (binomially-distributed) count of heads.</p>
<p>But if the investigator had actually performed this experiment, they would have observed more than just the total number of heads: they would have observed the entire sequence of <span class="math inline">\(n\)</span> heads and tails. If we let <span class="math inline">\(X_i\)</span> denote a binary indicator of whether the <span class="math inline">\(i\)</span>th throw is heads, for <span class="math inline">\(i=1,\ldots,n\)</span>, then we have assumed that these indicators are i.i.d. Bernoulli random variables:</p>
<p><span class="math display">\[
X_1,\ldots,X_n \simiid \text{Bern}(\theta).
\]</span></p>
<p>Let <span class="math inline">\(T(X) = \sum_i X_i \sim \text{Binom}(n,\theta)\)</span> denote the summary statistic that we previously used to represent the entire data set. It is undeniable that we have lost some information by only recording <span class="math inline">\(T(X)\)</span> instead of the entire sequence <span class="math inline">\(X = (X_1,\ldots,X_n)\)</span>. As a result, we might wonder whether we could have improved the estimator by considering all functions of <span class="math inline">\(X\)</span>, not just functions of <span class="math inline">\(T(X)\)</span>.</p>
<p>The answer is that, no, we did not really lose anything by summarizing the data by <span class="math inline">\(T(X)\)</span> because <span class="math inline">\(T(X)\)</span> is sufficient. The joint pmf of the data set <span class="math inline">\(X \in \{0,1\}^n\)</span> (i.e., the density wrt the counting measure on <span class="math inline">\(\{0,1\}^n\)</span>) is</p>
<p><span class="math display">\[
p_\theta(x) = \prod_{i=1}^n \theta^{x_i}(1-\theta)^{1-x_i} = \theta^{\sum_i x_i}(1-\theta)^{n-\sum_i x_i}.
\]</span></p>
<p>Note that this pmf depends only on <span class="math inline">\(T(x)\)</span>: it assigns probability <span class="math inline">\(\theta^t (1-\theta)^{n-t}\)</span> to every sequence with <span class="math inline">\(T(X)=t\)</span> total heads. As a result, the conditional distribution given <span class="math inline">\(T(X)=t\)</span> should be uniform on all of the <span class="math inline">\(\binom{n}{t}\)</span> sequences with <span class="math inline">\(t\)</span> heads. We can confirm this by calculating the conditional pmf directly:</p>
<p><span class="math display">\[
\begin{aligned}
\PP_\theta(X = x \mid T(X) = t)
&amp;= \frac{\PP_\theta(X=x, \sum_i X_i = t)}{\PP_\theta(T(X) = t)} \\[7pt]
&amp;= \frac{\theta^t (1-\theta)^{n-t}1\{\sum_i x_i = t\}}{\theta^t(1-\theta)^{n-t}\binom{n}{t}}\\[5pt]
&amp;= \binom{n}{t}^{-1}1\{T(x) = t\}.
\end{aligned}
\]</span></p>
<p>Since the conditional distribution does not depend on <span class="math inline">\(\theta\)</span>, <span class="math inline">\(T(X)\)</span> is sufficient for the model <span class="math inline">\(\cP\)</span>.</p>
</section>
<section id="visualization-of-sufficiency" class="level2">
<h2 class="anchored" data-anchor-id="visualization-of-sufficiency">Visualization of sufficiency</h2>
<p>The applet below illustrates the concept of sufficiency for a pair of random variables <span class="math inline">\(X_1,X_2 \simiid p_\theta(x)\)</span>, where <span class="math inline">\(p_\theta(x)\)</span> is a univariate probability mass function on <span class="math inline">\(\{0,\ldots,n\}\)</span>. We illustrate two cases, first the case where <span class="math inline">\(p_\theta(x)\)</span> is the binomial <span class="math display">\[
p_\theta(x) = \binom{n}{x}\theta^x(1-\theta)^{n-x},
\]</span> and second the case where <span class="math inline">\(p_\theta(x)\)</span> is a simple pmf we can call the “discrete Laplace” on <span class="math inline">\(\{0,\ldots,n\}\)</span> that decays exponentially with <span class="math inline">\(|x-n \theta|\)</span>: <span class="math display">\[
p_\theta(x) \propto e^{-|x-n\theta|}.
\]</span> As we will see shortly, <span class="math inline">\(T(X) = X_1+X_2\)</span> is a sufficient statistic in the binomial case, but it is not sufficient in the discrete Laplace case. To see this directly, select a value of <span class="math inline">\(n\)</span> and <span class="math inline">\(t\)</span>, and observe how the conditional distribution of <span class="math inline">\(X\)</span> given <span class="math inline">\(T(X)=t\)</span> does or does not change as you adjust the value of <span class="math inline">\(\theta\)</span>.</p>
<p>In either case, changing <span class="math inline">\(\theta\)</span> has a major effect on the joint probability distribution of <span class="math inline">\(X = (X_1,X_2)\)</span>; that is precisely why observing <span class="math inline">\(X\)</span> is informative about <span class="math inline">\(\theta\)</span>. But in the binomial case, having already observed <span class="math inline">\(T(X)\)</span>, <span class="math inline">\(\theta\)</span> has <em>no effect</em> on the conditional distribution of <span class="math inline">\(X\)</span>; that is why observing <span class="math inline">\(X\)</span> gives us no additional information about <span class="math inline">\(\theta\)</span>, once we’ve already seen <span class="math inline">\(T(X)\)</span>. In the discrete Laplace case, <span class="math inline">\(T(X)\)</span> is not sufficient: if <span class="math inline">\(\theta = 0.3\)</span>, <span class="math inline">\(X = (1,2)\)</span> is much more likely than</p>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb1" data-startfrom="63" data-source-offset="-39"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 62;"><span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>binomPMF <span class="op">=</span> (k<span class="op">,</span> n<span class="op">,</span> p) <span class="kw">=&gt;</span> {</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (k <span class="op">&lt;</span> <span class="dv">0</span> <span class="op">||</span> k <span class="op">&gt;</span> n) <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> binomCoeff <span class="op">=</span> <span class="fu">factorial</span>(n) <span class="op">/</span> (<span class="fu">factorial</span>(k) <span class="op">*</span> <span class="fu">factorial</span>(n <span class="op">-</span> k))<span class="op">;</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> binomCoeff <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(p<span class="op">,</span> k) <span class="op">*</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(<span class="dv">1</span> <span class="op">-</span> p<span class="op">,</span> n <span class="op">-</span> k)<span class="op">;</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a><span class="co">// Exponential-based probability mass function</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>expPMF <span class="op">=</span> (k<span class="op">,</span> n<span class="op">,</span> theta) <span class="kw">=&gt;</span> {</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (k <span class="op">&lt;</span> <span class="dv">0</span> <span class="op">||</span> k <span class="op">&gt;</span> n) <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Calculate unnormalized probabilities</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> unnormalized <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> sum <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> val <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">exp</span>(<span class="op">-</span><span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(i <span class="op">-</span> n <span class="op">*</span> theta))<span class="op">;</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>    unnormalized<span class="op">.</span><span class="fu">push</span>(val)<span class="op">;</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>    sum <span class="op">+=</span> val<span class="op">;</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Return normalized probability</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> unnormalized[k] <span class="op">/</span> sum<span class="op">;</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a><span class="co">// Factorial function with memoization</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>factorial <span class="op">=</span> (n) <span class="kw">=&gt;</span> {</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (n <span class="op">&lt;=</span> <span class="dv">1</span>) <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> result <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">2</span><span class="op">;</span> i <span class="op">&lt;=</span> n<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>    result <span class="op">*=</span> i<span class="op">;</span></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a><span class="co">// Interactive controls</span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>viewof n <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">1</span><span class="op">,</span> <span class="dv">8</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"n"</span>})</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>viewof theta <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.01</span><span class="op">,</span> <span class="fl">0.99</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="fl">0.30</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"θ"</span>})</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>viewof t_select <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">0</span><span class="op">,</span> <span class="dv">2</span><span class="op">*</span>n]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(<span class="dv">3</span><span class="op">,</span> <span class="dv">2</span><span class="op">*</span>n)<span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"T = t"</span>})</span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>viewof distributionType <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">radio</span>([<span class="st">"Binomial"</span><span class="op">,</span> <span class="st">"Discrete Laplace"</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="st">"Binomial"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Distribution"</span>})</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a><span class="co">// Select which PMF to use based on dropdown selection</span></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>pmf <span class="op">=</span> distributionType <span class="op">===</span> <span class="st">"Binomial"</span> <span class="op">?</span> binomPMF <span class="op">:</span> expPMF</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a><span class="co">// Generate joint distribution data</span></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>jointData <span class="op">=</span> {</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> x1 <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> x1 <span class="op">&lt;=</span> n<span class="op">;</span> x1<span class="op">++</span>) {</span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> x2 <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> x2 <span class="op">&lt;=</span> n<span class="op">;</span> x2<span class="op">++</span>) {</span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> prob <span class="op">=</span> <span class="fu">pmf</span>(x1<span class="op">,</span> n<span class="op">,</span> theta) <span class="op">*</span> <span class="fu">pmf</span>(x2<span class="op">,</span> n<span class="op">,</span> theta)<span class="op">;</span></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> t <span class="op">=</span> x1 <span class="op">+</span> x2<span class="op">;</span></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>      data<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x1</span><span class="op">:</span> x1<span class="op">,</span></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x2</span><span class="op">:</span> x2<span class="op">,</span></span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>        <span class="dt">prob</span><span class="op">:</span> prob<span class="op">,</span></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>        <span class="dt">t</span><span class="op">:</span> t<span class="op">,</span></span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>        <span class="dt">selected</span><span class="op">:</span> t <span class="op">===</span> t_select</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> data<span class="op">;</span></span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a><span class="co">// Generate conditional distribution data (X given T = t)</span></span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>conditionalData <span class="op">=</span> {</span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Only process if t_select is valid</span></span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (t_select <span class="op">&lt;=</span> <span class="dv">2</span> <span class="op">*</span> n) {</span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Find all (x1, x2) pairs where x1 + x2 = t</span></span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> validPairs <span class="op">=</span> jointData<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">t</span> <span class="op">===</span> t_select)<span class="op">;</span></span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> totalCondProb <span class="op">=</span> validPairs<span class="op">.</span><span class="fu">reduce</span>((sum<span class="op">,</span> d) <span class="kw">=&gt;</span> sum <span class="op">+</span> d<span class="op">.</span><span class="at">prob</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>    validPairs<span class="op">.</span><span class="fu">forEach</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (totalCondProb <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>        data<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>          <span class="dt">x1</span><span class="op">:</span> d<span class="op">.</span><span class="at">x1</span><span class="op">,</span></span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>          <span class="dt">x2</span><span class="op">:</span> d<span class="op">.</span><span class="at">x2</span><span class="op">,</span></span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>          <span class="dt">condProb</span><span class="op">:</span> d<span class="op">.</span><span class="at">prob</span> <span class="op">/</span> totalCondProb<span class="op">,</span></span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>          <span class="dt">t</span><span class="op">:</span> d<span class="op">.</span><span class="at">t</span></span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> data<span class="op">;</span></span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a><span class="co">// Calculate maximum probability for scaling</span></span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>maxProb <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="op">...</span>jointData<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">prob</span>))</span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>maxCondProb <span class="op">=</span> conditionalData<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="op">...</span>conditionalData<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">condProb</span>)) <span class="op">:</span> <span class="dv">1</span></span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a><span class="co">// Generate marginal distributions</span></span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>marginalX1 <span class="op">=</span> {</span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> x1 <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> x1 <span class="op">&lt;=</span> n<span class="op">;</span> x1<span class="op">++</span>) {</span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>    data<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> x1<span class="op">,</span></span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>      <span class="dt">prob</span><span class="op">:</span> <span class="fu">pmf</span>(x1<span class="op">,</span> n<span class="op">,</span> theta)</span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> data<span class="op">;</span></span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>marginalX2 <span class="op">=</span> {</span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> x2 <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> x2 <span class="op">&lt;=</span> n<span class="op">;</span> x2<span class="op">++</span>) {</span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>    data<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> x2<span class="op">,</span></span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>      <span class="dt">prob</span><span class="op">:</span> <span class="fu">pmf</span>(x2<span class="op">,</span> n<span class="op">,</span> theta)</span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> data<span class="op">;</span></span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a><span class="co">// Generate conditional marginal distributions</span></span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a>conditionalMarginalX1 <span class="op">=</span> {</span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalT <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(t_select<span class="op">,</span> <span class="dv">2</span> <span class="op">*</span> n)<span class="op">;</span></span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Only process if t_select is valid</span></span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (t_select <span class="op">&lt;=</span> <span class="dv">2</span> <span class="op">*</span> n) {</span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Calculate total probability for normalization</span></span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> totalProb <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> x1 <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> totalT <span class="op">-</span> n)<span class="op">;</span> x1 <span class="op">&lt;=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(n<span class="op">,</span> totalT)<span class="op">;</span> x1<span class="op">++</span>) {</span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> x2 <span class="op">=</span> totalT <span class="op">-</span> x1<span class="op">;</span></span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (x2 <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> x2 <span class="op">&lt;=</span> n) {</span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a>        totalProb <span class="op">+=</span> <span class="fu">pmf</span>(x1<span class="op">,</span> n<span class="op">,</span> theta) <span class="op">*</span> <span class="fu">pmf</span>(x2<span class="op">,</span> n<span class="op">,</span> theta)<span class="op">;</span></span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> x1 <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> x1 <span class="op">&lt;=</span> n<span class="op">;</span> x1<span class="op">++</span>) {</span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> x2 <span class="op">=</span> totalT <span class="op">-</span> x1<span class="op">;</span></span>
<span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (x2 <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> x2 <span class="op">&lt;=</span> n <span class="op">&amp;&amp;</span> totalProb <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> jointProb <span class="op">=</span> <span class="fu">pmf</span>(x1<span class="op">,</span> n<span class="op">,</span> theta) <span class="op">*</span> <span class="fu">pmf</span>(x2<span class="op">,</span> n<span class="op">,</span> theta)<span class="op">;</span></span>
<span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a>        data<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a>          <span class="dt">x1</span><span class="op">:</span> x1<span class="op">,</span></span>
<span id="cb1-196"><a href="#cb1-196" aria-hidden="true" tabindex="-1"></a>          <span class="dt">prob</span><span class="op">:</span> jointProb <span class="op">/</span> totalProb</span>
<span id="cb1-197"><a href="#cb1-197" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb1-198"><a href="#cb1-198" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-199"><a href="#cb1-199" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-200"><a href="#cb1-200" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-201"><a href="#cb1-201" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> data<span class="op">;</span></span>
<span id="cb1-202"><a href="#cb1-202" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-203"><a href="#cb1-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-204"><a href="#cb1-204" aria-hidden="true" tabindex="-1"></a>conditionalMarginalX2 <span class="op">=</span> {</span>
<span id="cb1-205"><a href="#cb1-205" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb1-206"><a href="#cb1-206" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalT <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(t_select<span class="op">,</span> <span class="dv">2</span> <span class="op">*</span> n)<span class="op">;</span></span>
<span id="cb1-207"><a href="#cb1-207" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-208"><a href="#cb1-208" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Only process if t_select is valid  </span></span>
<span id="cb1-209"><a href="#cb1-209" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (t_select <span class="op">&lt;=</span> <span class="dv">2</span> <span class="op">*</span> n) {</span>
<span id="cb1-210"><a href="#cb1-210" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Calculate total probability for normalization</span></span>
<span id="cb1-211"><a href="#cb1-211" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> totalProb <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-212"><a href="#cb1-212" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> x2 <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> totalT <span class="op">-</span> n)<span class="op">;</span> x2 <span class="op">&lt;=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(n<span class="op">,</span> totalT)<span class="op">;</span> x2<span class="op">++</span>) {</span>
<span id="cb1-213"><a href="#cb1-213" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> x1 <span class="op">=</span> totalT <span class="op">-</span> x2<span class="op">;</span></span>
<span id="cb1-214"><a href="#cb1-214" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (x1 <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> x1 <span class="op">&lt;=</span> n) {</span>
<span id="cb1-215"><a href="#cb1-215" aria-hidden="true" tabindex="-1"></a>        totalProb <span class="op">+=</span> <span class="fu">pmf</span>(x1<span class="op">,</span> n<span class="op">,</span> theta) <span class="op">*</span> <span class="fu">pmf</span>(x2<span class="op">,</span> n<span class="op">,</span> theta)<span class="op">;</span></span>
<span id="cb1-216"><a href="#cb1-216" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-217"><a href="#cb1-217" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-218"><a href="#cb1-218" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-219"><a href="#cb1-219" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> x2 <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> x2 <span class="op">&lt;=</span> n<span class="op">;</span> x2<span class="op">++</span>) {</span>
<span id="cb1-220"><a href="#cb1-220" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> x1 <span class="op">=</span> totalT <span class="op">-</span> x2<span class="op">;</span></span>
<span id="cb1-221"><a href="#cb1-221" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (x1 <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> x1 <span class="op">&lt;=</span> n <span class="op">&amp;&amp;</span> totalProb <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb1-222"><a href="#cb1-222" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> jointProb <span class="op">=</span> <span class="fu">pmf</span>(x1<span class="op">,</span> n<span class="op">,</span> theta) <span class="op">*</span> <span class="fu">pmf</span>(x2<span class="op">,</span> n<span class="op">,</span> theta)<span class="op">;</span></span>
<span id="cb1-223"><a href="#cb1-223" aria-hidden="true" tabindex="-1"></a>        data<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb1-224"><a href="#cb1-224" aria-hidden="true" tabindex="-1"></a>          <span class="dt">x2</span><span class="op">:</span> x2<span class="op">,</span></span>
<span id="cb1-225"><a href="#cb1-225" aria-hidden="true" tabindex="-1"></a>          <span class="dt">prob</span><span class="op">:</span> jointProb <span class="op">/</span> totalProb</span>
<span id="cb1-226"><a href="#cb1-226" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb1-227"><a href="#cb1-227" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-228"><a href="#cb1-228" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-229"><a href="#cb1-229" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-230"><a href="#cb1-230" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> data<span class="op">;</span></span>
<span id="cb1-231"><a href="#cb1-231" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-232"><a href="#cb1-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-233"><a href="#cb1-233" aria-hidden="true" tabindex="-1"></a>maxRad <span class="op">=</span> <span class="dv">15</span> <span class="op">*</span> <span class="dv">5</span> <span class="op">/</span> (n <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb1-234"><a href="#cb1-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-235"><a href="#cb1-235" aria-hidden="true" tabindex="-1"></a>maxMarginalProb <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="op">...</span>marginalX1<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">prob</span>)<span class="op">,</span> <span class="op">...</span>marginalX2<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">prob</span>))</span>
<span id="cb1-236"><a href="#cb1-236" aria-hidden="true" tabindex="-1"></a>maxCondMarginalProb <span class="op">=</span> conditionalMarginalX1<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> conditionalMarginalX2<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> </span>
<span id="cb1-237"><a href="#cb1-237" aria-hidden="true" tabindex="-1"></a>  <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="op">...</span>conditionalMarginalX1<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">prob</span>)<span class="op">,</span> <span class="op">...</span>conditionalMarginalX2<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">prob</span>)) <span class="op">:</span> <span class="dv">1</span></span>
<span id="cb1-238"><a href="#cb1-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-239"><a href="#cb1-239" aria-hidden="true" tabindex="-1"></a><span class="co">// Create joint distribution plot with marginal histograms</span></span>
<span id="cb1-240"><a href="#cb1-240" aria-hidden="true" tabindex="-1"></a>jointPlot <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb1-241"><a href="#cb1-241" aria-hidden="true" tabindex="-1"></a>  <span class="dt">width</span><span class="op">:</span> <span class="dv">480</span><span class="op">,</span></span>
<span id="cb1-242"><a href="#cb1-242" aria-hidden="true" tabindex="-1"></a>  <span class="dt">height</span><span class="op">:</span> <span class="dv">480</span><span class="op">,</span></span>
<span id="cb1-243"><a href="#cb1-243" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marginTop</span><span class="op">:</span> <span class="dv">140</span><span class="op">,</span></span>
<span id="cb1-244"><a href="#cb1-244" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marginLeft</span><span class="op">:</span> <span class="dv">80</span><span class="op">,</span></span>
<span id="cb1-245"><a href="#cb1-245" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marginBottom</span><span class="op">:</span> <span class="dv">80</span><span class="op">,</span></span>
<span id="cb1-246"><a href="#cb1-246" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marginRight</span><span class="op">:</span> <span class="dv">120</span><span class="op">,</span></span>
<span id="cb1-247"><a href="#cb1-247" aria-hidden="true" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> { <span class="dt">fontSize</span><span class="op">:</span> <span class="st">"16px"</span> }<span class="op">,</span></span>
<span id="cb1-248"><a href="#cb1-248" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-249"><a href="#cb1-249" aria-hidden="true" tabindex="-1"></a>  <span class="dt">r</span><span class="op">:</span> {</span>
<span id="cb1-250"><a href="#cb1-250" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"linear"</span><span class="op">,</span></span>
<span id="cb1-251"><a href="#cb1-251" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> maxRad]<span class="op">,</span>  <span class="co">// Fixed domain from 0 to maxRad</span></span>
<span id="cb1-252"><a href="#cb1-252" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> maxRad]<span class="op">,</span>   <span class="co">// Maps directly to pixel sizes</span></span>
<span id="cb1-253"><a href="#cb1-253" aria-hidden="true" tabindex="-1"></a>    <span class="dt">clamp</span><span class="op">:</span> <span class="kw">false</span>       <span class="co">// Prevents values outside domain</span></span>
<span id="cb1-254"><a href="#cb1-254" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb1-255"><a href="#cb1-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-256"><a href="#cb1-256" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-257"><a href="#cb1-257" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb1-258"><a href="#cb1-258" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="op">-</span><span class="fl">0.5</span><span class="op">,</span> n <span class="op">+</span> <span class="fl">0.5</span>]<span class="op">,</span></span>
<span id="cb1-259"><a href="#cb1-259" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({<span class="dt">length</span><span class="op">:</span> n <span class="op">+</span> <span class="dv">1</span>}<span class="op">,</span> (_<span class="op">,</span> i) <span class="kw">=&gt;</span> i)<span class="op">,</span></span>
<span id="cb1-260"><a href="#cb1-260" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tickFormat</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="fu">toString</span>()<span class="op">,</span></span>
<span id="cb1-261"><a href="#cb1-261" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"X₁"</span><span class="op">,</span></span>
<span id="cb1-262"><a href="#cb1-262" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelAnchor</span><span class="op">:</span> <span class="st">"center"</span><span class="op">,</span></span>
<span id="cb1-263"><a href="#cb1-263" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelOffset</span><span class="op">:</span> <span class="dv">50</span></span>
<span id="cb1-264"><a href="#cb1-264" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb1-265"><a href="#cb1-265" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb1-266"><a href="#cb1-266" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="op">-</span><span class="fl">0.5</span><span class="op">,</span> n <span class="op">+</span> <span class="fl">0.5</span>]<span class="op">,</span></span>
<span id="cb1-267"><a href="#cb1-267" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({<span class="dt">length</span><span class="op">:</span> n <span class="op">+</span> <span class="dv">1</span>}<span class="op">,</span> (_<span class="op">,</span> i) <span class="kw">=&gt;</span> i)<span class="op">,</span></span>
<span id="cb1-268"><a href="#cb1-268" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tickFormat</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="fu">toString</span>()<span class="op">,</span></span>
<span id="cb1-269"><a href="#cb1-269" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"X₂"</span><span class="op">,</span></span>
<span id="cb1-270"><a href="#cb1-270" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelAnchor</span><span class="op">:</span> <span class="st">"center"</span><span class="op">,</span></span>
<span id="cb1-271"><a href="#cb1-271" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelOffset</span><span class="op">:</span> <span class="dv">50</span></span>
<span id="cb1-272"><a href="#cb1-272" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb1-273"><a href="#cb1-273" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-274"><a href="#cb1-274" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb1-275"><a href="#cb1-275" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Grid lines</span></span>
<span id="cb1-276"><a href="#cb1-276" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleX</span>(<span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({<span class="dt">length</span><span class="op">:</span> n <span class="op">+</span> <span class="dv">1</span>}<span class="op">,</span> (_<span class="op">,</span> i) <span class="kw">=&gt;</span> i)<span class="op">,</span> {<span class="dt">stroke</span><span class="op">:</span> <span class="st">"#f0f0f0"</span>})<span class="op">,</span></span>
<span id="cb1-277"><a href="#cb1-277" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleY</span>(<span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({<span class="dt">length</span><span class="op">:</span> n <span class="op">+</span> <span class="dv">1</span>}<span class="op">,</span> (_<span class="op">,</span> i) <span class="kw">=&gt;</span> i)<span class="op">,</span> {<span class="dt">stroke</span><span class="op">:</span> <span class="st">"#f0f0f0"</span>})<span class="op">,</span></span>
<span id="cb1-278"><a href="#cb1-278" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-279"><a href="#cb1-279" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Probability circles</span></span>
<span id="cb1-280"><a href="#cb1-280" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dot</span>(jointData<span class="op">,</span> {</span>
<span id="cb1-281"><a href="#cb1-281" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x1"</span><span class="op">,</span> </span>
<span id="cb1-282"><a href="#cb1-282" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"x2"</span><span class="op">,</span> </span>
<span id="cb1-283"><a href="#cb1-283" aria-hidden="true" tabindex="-1"></a>      <span class="dt">r</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(d<span class="op">.</span><span class="at">prob</span> <span class="op">/</span> maxProb) <span class="op">*</span> maxRad<span class="op">,</span>   </span>
<span id="cb1-284"><a href="#cb1-284" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">selected</span> <span class="op">?</span> <span class="st">"red"</span> <span class="op">:</span> <span class="st">"steelblue"</span><span class="op">,</span></span>
<span id="cb1-285"><a href="#cb1-285" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.7</span><span class="op">,</span></span>
<span id="cb1-286"><a href="#cb1-286" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb1-287"><a href="#cb1-287" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">0.5</span></span>
<span id="cb1-288"><a href="#cb1-288" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb1-289"><a href="#cb1-289" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-290"><a href="#cb1-290" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Top marginal histogram (X₁)</span></span>
<span id="cb1-291"><a href="#cb1-291" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(marginalX1<span class="op">,</span> {</span>
<span id="cb1-292"><a href="#cb1-292" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x1</span> <span class="op">-</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb1-293"><a href="#cb1-293" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x1</span> <span class="op">+</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb1-294"><a href="#cb1-294" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> n <span class="op">+</span> <span class="fl">0.56</span> <span class="op">+</span> n <span class="op">*</span> <span class="op">.</span><span class="bn">06</span><span class="op">,</span></span>
<span id="cb1-295"><a href="#cb1-295" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> n <span class="op">+</span> <span class="fl">0.56</span> <span class="op">+</span> n <span class="op">*</span> <span class="op">.</span><span class="bn">06</span> <span class="op">+</span> (d<span class="op">.</span><span class="at">prob</span> <span class="op">/</span> maxMarginalProb) <span class="op">*</span> (n <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb1-296"><a href="#cb1-296" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"steelblue"</span><span class="op">,</span></span>
<span id="cb1-297"><a href="#cb1-297" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.7</span><span class="op">,</span></span>
<span id="cb1-298"><a href="#cb1-298" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb1-299"><a href="#cb1-299" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">0.5</span></span>
<span id="cb1-300"><a href="#cb1-300" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb1-301"><a href="#cb1-301" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-302"><a href="#cb1-302" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Right marginal histogram (X₂)</span></span>
<span id="cb1-303"><a href="#cb1-303" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(marginalX2<span class="op">,</span> {</span>
<span id="cb1-304"><a href="#cb1-304" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> n <span class="op">+</span> <span class="fl">0.56</span> <span class="op">+</span> n <span class="op">*</span> <span class="op">.</span><span class="bn">06</span><span class="op">,</span></span>
<span id="cb1-305"><a href="#cb1-305" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> n <span class="op">+</span> <span class="fl">0.56</span> <span class="op">+</span> n <span class="op">*</span> <span class="op">.</span><span class="bn">06</span> <span class="op">+</span> (d<span class="op">.</span><span class="at">prob</span> <span class="op">/</span> maxMarginalProb) <span class="op">*</span> (n <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb1-306"><a href="#cb1-306" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x2</span> <span class="op">-</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb1-307"><a href="#cb1-307" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x2</span> <span class="op">+</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb1-308"><a href="#cb1-308" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"steelblue"</span><span class="op">,</span></span>
<span id="cb1-309"><a href="#cb1-309" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.7</span><span class="op">,</span></span>
<span id="cb1-310"><a href="#cb1-310" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb1-311"><a href="#cb1-311" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">0.5</span></span>
<span id="cb1-312"><a href="#cb1-312" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb1-313"><a href="#cb1-313" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-314"><a href="#cb1-314" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Title</span></span>
<span id="cb1-315"><a href="#cb1-315" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>([<span class="st">"Joint Distribution of X = (X₁, X₂)"</span>]<span class="op">,</span> {</span>
<span id="cb1-316"><a href="#cb1-316" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> n<span class="op">/</span><span class="dv">2</span><span class="op">,</span> </span>
<span id="cb1-317"><a href="#cb1-317" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> n <span class="op">+</span> <span class="fl">0.5</span> <span class="op">+</span> (n <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> <span class="op">.</span><span class="dv">45</span><span class="op">,</span> </span>
<span id="cb1-318"><a href="#cb1-318" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">24</span><span class="op">,</span> </span>
<span id="cb1-319"><a href="#cb1-319" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb1-320"><a href="#cb1-320" aria-hidden="true" tabindex="-1"></a>      <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"middle"</span></span>
<span id="cb1-321"><a href="#cb1-321" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb1-322"><a href="#cb1-322" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb1-323"><a href="#cb1-323" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb1-324"><a href="#cb1-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-325"><a href="#cb1-325" aria-hidden="true" tabindex="-1"></a><span class="co">// Create conditional distribution plot with conditional marginal histograms</span></span>
<span id="cb1-326"><a href="#cb1-326" aria-hidden="true" tabindex="-1"></a>conditionalPlot <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb1-327"><a href="#cb1-327" aria-hidden="true" tabindex="-1"></a>  <span class="dt">width</span><span class="op">:</span> <span class="dv">480</span><span class="op">,</span></span>
<span id="cb1-328"><a href="#cb1-328" aria-hidden="true" tabindex="-1"></a>  <span class="dt">height</span><span class="op">:</span> <span class="dv">480</span><span class="op">,</span></span>
<span id="cb1-329"><a href="#cb1-329" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marginTop</span><span class="op">:</span> <span class="dv">140</span><span class="op">,</span></span>
<span id="cb1-330"><a href="#cb1-330" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marginLeft</span><span class="op">:</span> <span class="dv">80</span><span class="op">,</span></span>
<span id="cb1-331"><a href="#cb1-331" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marginBottom</span><span class="op">:</span> <span class="dv">80</span><span class="op">,</span></span>
<span id="cb1-332"><a href="#cb1-332" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marginRight</span><span class="op">:</span> <span class="dv">120</span><span class="op">,</span></span>
<span id="cb1-333"><a href="#cb1-333" aria-hidden="true" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> { <span class="dt">fontSize</span><span class="op">:</span> <span class="st">"16px"</span> }<span class="op">,</span></span>
<span id="cb1-334"><a href="#cb1-334" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-335"><a href="#cb1-335" aria-hidden="true" tabindex="-1"></a>  <span class="dt">r</span><span class="op">:</span> {</span>
<span id="cb1-336"><a href="#cb1-336" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"linear"</span><span class="op">,</span></span>
<span id="cb1-337"><a href="#cb1-337" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> maxRad]<span class="op">,</span>  <span class="co">// Fixed domain from 0 to 20</span></span>
<span id="cb1-338"><a href="#cb1-338" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> maxRad]<span class="op">,</span>   <span class="co">// Maps directly to pixel   sizes  </span></span>
<span id="cb1-339"><a href="#cb1-339" aria-hidden="true" tabindex="-1"></a>    <span class="dt">clamp</span><span class="op">:</span> <span class="kw">false</span>       <span class="co">// Prevents values outside domain</span></span>
<span id="cb1-340"><a href="#cb1-340" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb1-341"><a href="#cb1-341" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb1-342"><a href="#cb1-342" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="op">-</span><span class="fl">0.5</span><span class="op">,</span> n <span class="op">+</span> <span class="fl">0.5</span>]<span class="op">,</span></span>
<span id="cb1-343"><a href="#cb1-343" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({<span class="dt">length</span><span class="op">:</span> n <span class="op">+</span> <span class="dv">1</span>}<span class="op">,</span> (_<span class="op">,</span> i) <span class="kw">=&gt;</span> i)<span class="op">,</span></span>
<span id="cb1-344"><a href="#cb1-344" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tickFormat</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="fu">toString</span>()<span class="op">,</span></span>
<span id="cb1-345"><a href="#cb1-345" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"X₁"</span><span class="op">,</span></span>
<span id="cb1-346"><a href="#cb1-346" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelAnchor</span><span class="op">:</span> <span class="st">"center"</span><span class="op">,</span></span>
<span id="cb1-347"><a href="#cb1-347" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelOffset</span><span class="op">:</span> <span class="dv">50</span></span>
<span id="cb1-348"><a href="#cb1-348" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb1-349"><a href="#cb1-349" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb1-350"><a href="#cb1-350" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="op">-</span><span class="fl">0.5</span><span class="op">,</span> n <span class="op">+</span> <span class="fl">0.5</span>]<span class="op">,</span></span>
<span id="cb1-351"><a href="#cb1-351" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({<span class="dt">length</span><span class="op">:</span> n <span class="op">+</span> <span class="dv">1</span>}<span class="op">,</span> (_<span class="op">,</span> i) <span class="kw">=&gt;</span> i)<span class="op">,</span></span>
<span id="cb1-352"><a href="#cb1-352" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tickFormat</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="fu">toString</span>()<span class="op">,</span></span>
<span id="cb1-353"><a href="#cb1-353" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"X₂"</span><span class="op">,</span></span>
<span id="cb1-354"><a href="#cb1-354" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelAnchor</span><span class="op">:</span> <span class="st">"center"</span><span class="op">,</span></span>
<span id="cb1-355"><a href="#cb1-355" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelOffset</span><span class="op">:</span> <span class="dv">50</span></span>
<span id="cb1-356"><a href="#cb1-356" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb1-357"><a href="#cb1-357" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-358"><a href="#cb1-358" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb1-359"><a href="#cb1-359" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Grid lines</span></span>
<span id="cb1-360"><a href="#cb1-360" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleX</span>(<span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({<span class="dt">length</span><span class="op">:</span> n <span class="op">+</span> <span class="dv">1</span>}<span class="op">,</span> (_<span class="op">,</span> i) <span class="kw">=&gt;</span> i)<span class="op">,</span> {<span class="dt">stroke</span><span class="op">:</span> <span class="st">"#f0f0f0"</span>})<span class="op">,</span></span>
<span id="cb1-361"><a href="#cb1-361" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleY</span>(<span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({<span class="dt">length</span><span class="op">:</span> n <span class="op">+</span> <span class="dv">1</span>}<span class="op">,</span> (_<span class="op">,</span> i) <span class="kw">=&gt;</span> i)<span class="op">,</span> {<span class="dt">stroke</span><span class="op">:</span> <span class="st">"#f0f0f0"</span>})<span class="op">,</span></span>
<span id="cb1-362"><a href="#cb1-362" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-363"><a href="#cb1-363" aria-hidden="true" tabindex="-1"></a>    <span class="co">// All possible points (faded)</span></span>
<span id="cb1-364"><a href="#cb1-364" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dot</span>(jointData<span class="op">,</span> {</span>
<span id="cb1-365"><a href="#cb1-365" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x1"</span><span class="op">,</span> </span>
<span id="cb1-366"><a href="#cb1-366" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"x2"</span><span class="op">,</span> </span>
<span id="cb1-367"><a href="#cb1-367" aria-hidden="true" tabindex="-1"></a>      <span class="dt">r</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb1-368"><a href="#cb1-368" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"lightgray"</span><span class="op">,</span></span>
<span id="cb1-369"><a href="#cb1-369" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.3</span></span>
<span id="cb1-370"><a href="#cb1-370" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb1-371"><a href="#cb1-371" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-372"><a href="#cb1-372" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Conditional probability circles</span></span>
<span id="cb1-373"><a href="#cb1-373" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dot</span>(conditionalData<span class="op">,</span> {</span>
<span id="cb1-374"><a href="#cb1-374" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x1"</span><span class="op">,</span> </span>
<span id="cb1-375"><a href="#cb1-375" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"x2"</span><span class="op">,</span> </span>
<span id="cb1-376"><a href="#cb1-376" aria-hidden="true" tabindex="-1"></a>      <span class="dt">r</span><span class="op">:</span> d <span class="kw">=&gt;</span> conditionalData<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(d<span class="op">.</span><span class="at">condProb</span> <span class="op">/</span> maxCondProb) <span class="op">*</span> maxRad <span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb1-377"><a href="#cb1-377" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"red"</span><span class="op">,</span></span>
<span id="cb1-378"><a href="#cb1-378" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.8</span><span class="op">,</span></span>
<span id="cb1-379"><a href="#cb1-379" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb1-380"><a href="#cb1-380" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb1-381"><a href="#cb1-381" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb1-382"><a href="#cb1-382" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-383"><a href="#cb1-383" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Top conditional marginal histogram (X₁ | T = t)</span></span>
<span id="cb1-384"><a href="#cb1-384" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(conditionalMarginalX1<span class="op">,</span> {</span>
<span id="cb1-385"><a href="#cb1-385" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x1</span> <span class="op">-</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb1-386"><a href="#cb1-386" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x1</span> <span class="op">+</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb1-387"><a href="#cb1-387" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> n <span class="op">+</span> <span class="fl">0.56</span> <span class="op">+</span> n <span class="op">*</span> <span class="op">.</span><span class="bn">06</span><span class="op">,</span></span>
<span id="cb1-388"><a href="#cb1-388" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> n <span class="op">+</span> <span class="fl">0.56</span> <span class="op">+</span> n <span class="op">*</span> <span class="op">.</span><span class="bn">06</span> <span class="op">+</span> (d<span class="op">.</span><span class="at">prob</span> <span class="op">/</span> maxCondMarginalProb) <span class="op">*</span> (n <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb1-389"><a href="#cb1-389" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"red"</span><span class="op">,</span></span>
<span id="cb1-390"><a href="#cb1-390" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.7</span><span class="op">,</span></span>
<span id="cb1-391"><a href="#cb1-391" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb1-392"><a href="#cb1-392" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">0.5</span></span>
<span id="cb1-393"><a href="#cb1-393" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb1-394"><a href="#cb1-394" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-395"><a href="#cb1-395" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Right conditional marginal histogram (X₂ | T = t)</span></span>
<span id="cb1-396"><a href="#cb1-396" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(conditionalMarginalX2<span class="op">,</span> {</span>
<span id="cb1-397"><a href="#cb1-397" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> n <span class="op">+</span> <span class="fl">0.56</span> <span class="op">+</span> n <span class="op">*</span> <span class="op">.</span><span class="bn">06</span><span class="op">,</span></span>
<span id="cb1-398"><a href="#cb1-398" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> n <span class="op">+</span> <span class="fl">0.56</span> <span class="op">+</span> n <span class="op">*</span> <span class="op">.</span><span class="bn">06</span> <span class="op">+</span> (d<span class="op">.</span><span class="at">prob</span> <span class="op">/</span> maxCondMarginalProb) <span class="op">*</span> (n <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb1-399"><a href="#cb1-399" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x2</span> <span class="op">-</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb1-400"><a href="#cb1-400" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x2</span> <span class="op">+</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb1-401"><a href="#cb1-401" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"red"</span><span class="op">,</span></span>
<span id="cb1-402"><a href="#cb1-402" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.7</span><span class="op">,</span></span>
<span id="cb1-403"><a href="#cb1-403" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb1-404"><a href="#cb1-404" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">0.5</span></span>
<span id="cb1-405"><a href="#cb1-405" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb1-406"><a href="#cb1-406" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-407"><a href="#cb1-407" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Title</span></span>
<span id="cb1-408"><a href="#cb1-408" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>([<span class="vs">`Conditional Distribution P(X | T = </span><span class="sc">${</span>t_select<span class="sc">}</span><span class="vs">)`</span>]<span class="op">,</span> {</span>
<span id="cb1-409"><a href="#cb1-409" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> n<span class="op">/</span><span class="dv">2</span><span class="op">,</span> </span>
<span id="cb1-410"><a href="#cb1-410" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> n <span class="op">+</span> <span class="fl">0.5</span> <span class="op">+</span> (n <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> <span class="op">.</span><span class="dv">45</span><span class="op">,</span> </span>
<span id="cb1-411"><a href="#cb1-411" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">24</span><span class="op">,</span> </span>
<span id="cb1-412"><a href="#cb1-412" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb1-413"><a href="#cb1-413" aria-hidden="true" tabindex="-1"></a>      <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"middle"</span></span>
<span id="cb1-414"><a href="#cb1-414" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb1-415"><a href="#cb1-415" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb1-416"><a href="#cb1-416" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb1-417"><a href="#cb1-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-418"><a href="#cb1-418" aria-hidden="true" tabindex="-1"></a><span class="co">// Display plots side by side</span></span>
<span id="cb1-419"><a href="#cb1-419" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`&lt;div style="display: flex; gap: 20px; align-items: center; justify-content: center;"&gt;</span></span>
<span id="cb1-420"><a href="#cb1-420" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span><span class="sc">${</span>jointPlot<span class="sc">}</span></span>
<span id="cb1-421"><a href="#cb1-421" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span><span class="sc">${</span>conditionalPlot<span class="sc">}</span></span>
<span id="cb1-422"><a href="#cb1-422" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;/div&gt;`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-14" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-15" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-16" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-17" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-18" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-19" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-20" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-21" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-1-22" data-nodetype="expression">

</div>
</div>
</div>
</div>
<p>To understand why <span class="math inline">\(T(X)\)</span> is sufficient in the binomial case, we can make a simple calculation on the joint pmf of the random vector <span class="math inline">\(X = (X_1,X_2)\)</span>: <span class="math display">\[
\begin{aligned}
\PP_\theta(X = x) &amp;= \binom{n}{x_1} \theta^{x_1}(1-\theta)^{n-x_1} \cdot \binom{n}{x_2} \theta^{x_2}(1-\theta)^{n-x_2}\\[7pt]
&amp;= \theta^{T(x)}(1-\theta)^{2n-T(x)} \binom{n}{x_1}\binom{n}{x_2},
\end{aligned}
\]</span></p>
<p>When we calculate the conditional distribution of <span class="math inline">\(X\)</span> given <span class="math inline">\(T(X) = t\)</span> by Bayes’ rule, the factor that depends on <span class="math inline">\(\theta\)</span> drops out as before: <span class="math display">\[
\begin{aligned}
\PP_\theta(X = x \mid T(X) = t) &amp;= \frac{\theta^{t}(1-\theta)^{2n-t} \binom{n}{x_1}\binom{n}{x_2}1\{x_1+x_2=t\} }{\sum_{k=0}^t \theta^t(1-\theta)^{2n-t} \binom{n}{k}\binom{n}{t-k}}\cdot\\[7pt]
&amp;= \frac{\binom{n}{x_1}\binom{n}{x_2}1\{x_1+x_2=t\}}{\sum_{k=0}^t \binom{n}{k}\binom{n}{t-k}},
\end{aligned}
\]</span> giving a conditional distribution with no dependence on <span class="math inline">\(\theta\)</span>. Applying the combinatorial identity <span class="math inline">\(\sum_{k=0}^t \binom{n}{k}\binom{n}{t-k} = \binom{2n}{t}\)</span>, we obtain a hypergeometric distribution for <span class="math inline">\(x_1\)</span> (or for <span class="math inline">\(x_2\)</span>): <span class="math display">\[
\PP_\theta(X_1 = x_1 \mid T(X) = t) = \frac{\binom{n}{x_1}\binom{n}{t-x_1}}{\binom{2n}{t}} = \text{Hypergeom}(2n,n,t).
\]</span></p>
<p>The next section generalizes this calculation to any density that can be factorized in a similar way, giving us an easy way to recognize sufficient statistics just by inspecting the joint density.</p>
</section>
<section id="factorization-theorem" class="level2">
<h2 class="anchored" data-anchor-id="factorization-theorem">Factorization theorem</h2>
<p>We didn’t really need to go to the trouble of calculating the conditional distribution in the previous examples. The easiest way to verify that a statistic is sufficient is to show that the density <span class="math inline">\(p_\theta\)</span> factorizes into a part that involves only <span class="math inline">\(\theta\)</span> and <span class="math inline">\(T(x)\)</span>, and a part that involves only <span class="math inline">\(x\)</span>.</p>
<p><strong>Factorization Theorem:</strong> Let <span class="math inline">\(\cP\)</span> be a model having densities <span class="math inline">\(p_\theta(x)\)</span> with respect to a common dominating measure <span class="math inline">\(\mu\)</span>. Then <span class="math inline">\(T(X)\)</span> is sufficient for <span class="math inline">\(\cP\)</span> if and only if there exist non-negative functions <span class="math inline">\(g_\theta\)</span> and <span class="math inline">\(h\)</span> for which</p>
<p><span class="math display">\[
p_\theta(x) = g_\theta(T(x)) h(x),
\]</span></p>
<p>for almost every <span class="math inline">\(x\)</span> under <span class="math inline">\(\mu\)</span>.</p>
<p>The “almost every <span class="math inline">\(x\)</span>” qualification means that</p>
<p><span class="math display">\[
\mu\left(\{x:\; p_\theta(x) \neq g_\theta(T(x))h(x)\}\right) = 0.
\]</span></p>
<p>It is needed to avoid counterexamples where we mess with the densities on a set of points that the base measure doesn’t assign any mass, which would let us destroy the factorization structure without changing any of the distributions.</p>
<p><strong>Proof (discrete</strong> <span class="math inline">\(\cX\)</span>): The proof is easiest in the discrete case, so that we don’t have to deal with conditioning on measure-zero events and worry about things like Jacobians for change of variables.</p>
<p>We’ll assume without loss of generality that <span class="math inline">\(\mu\)</span> is the counting measure: if <span class="math inline">\(\mu\)</span> were some other measure, it would have to have a density <span class="math inline">\(m\)</span> with respect to the counting measure and we would just have to carry around <span class="math inline">\(m(x)\)</span> in all of our expressions.</p>
<p>First, assume that there exists a factorization <span class="math inline">\(p_\theta(x) = g_\theta(T(x)) h(x)\)</span>. Then we have</p>
<p><span class="math display">\[
\begin{aligned}
\PP_\theta(X = x \mid T(X) = t)
&amp;= \frac{\PP_\theta(X = x, T(X) = t)}{\PP_\theta(T(X) = t)}\\[7pt]
&amp;= \frac{g_\theta(t) h(x) 1\{T(x) = t\}}{g_\theta(t)\displaystyle\sum_{z:\;T(z) = t} h(z)}\\[7pt]
&amp;= \frac{h(x) 1\{T(x) = t\}}{\displaystyle\sum_{z:\;T(z) = t} h(z)},
\end{aligned}
\]</span></p>
<p>which we see does not depend on <span class="math inline">\(\theta\)</span>.</p>
<p>Next consider the opposite direction. If <span class="math inline">\(T(X)\)</span> is sufficient, then we can construct a factorization by writing</p>
<p><span class="math display">\[
\begin{aligned}
g_\theta(t) &amp;= \PP_\theta(T(X)=t)\\
h(x) &amp;= \PP(X = x \mid T(X) = T(x)),
\end{aligned}
\]</span> noting that the conditional probability in the definition of <span class="math inline">\(h(x)\)</span> does not depend on <span class="math inline">\(\theta\)</span> by sufficiency. Then we have</p>
<p><span class="math display">\[
\PP_\theta(X = x) = \PP_\theta(T(X) = T(x)) \;\cdot\;\PP_\theta(X = x \mid T(X) = T(x)) = g_\theta(T(x)) h(x),
\]</span> so <span class="math inline">\(g_\theta(T(x))h(x)\)</span> is indeed the pmf <span class="math inline">\(p_\theta(x)\)</span>.</p>
</section>
<section id="statement-for-general-mathcalx" class="level2">
<h2 class="anchored" data-anchor-id="statement-for-general-mathcalx">Statement for general <span class="math inline">\(\mathcal{X}\)</span></h2>
</section>
<section id="examples" class="level2">
<h2 class="anchored" data-anchor-id="examples">Examples</h2>
<p>Some initial examples:</p>
<p><strong>Example: Normal location family</strong> Assume we observe an i.i.d. sample from a normal distribution with unit variance and unknown mean:</p>
<p><span class="math display">\[
X_1,\ldots,X_n \simiid N(\theta,1) = \frac{1}{\sqrt{2\pi}} e^{-(x-\theta)^2/2} = \frac{1}{\sqrt{2\pi}} e^{-x^2/2 + \theta x - \theta^2/2}
\]</span></p>
<p>The joint density function for the full data set <span class="math inline">\(X = (X_1,\ldots,X_n)\)</span> over <span class="math inline">\(\RR^n\)</span> is</p>
<p><span class="math display">\[
\begin{aligned}
p_\theta(x) &amp;= (2\pi)^{-n/2} \cdot \prod_{i=1}^n e^{-x_i^2/2 + \theta x_i - \theta^2/2}\\[7pt]
&amp;= \underbrace{e^{\theta \left(\sum_i x_i\right) -n\theta^2/2}}_{g_\theta\left(\sum_i x_i\right)}\cdot \underbrace{\frac{\prod_{i=1}^n e^{-x_i^2/2}}{(2\pi)^{-n/2}}}_{h(x)},
\end{aligned}
\]</span> which by the factorization theorem shows that <span class="math inline">\(\sum_i X_i\)</span> is sufficient.</p>
<p><strong>Example: Poisson family</strong> Next assume we observe an i.i.d. sample from a Poisson distribution with unknown mean <span class="math inline">\(\theta\)</span>:</p>
<p><span class="math display">\[
X_1,\ldots,X_n \simiid \text{Pois}(\theta) = \frac{\theta^x e^{-\theta}}{x!}, \quad \text{ for } x = 0,1,\ldots
\]</span> The joint pmf for the full data set <span class="math inline">\(X = (X_1,\ldots,X_n)\)</span> over <span class="math inline">\(\{0,1,\ldots\}^n\)</span> is</p>
<p><span class="math display">\[
\begin{aligned}
p_\theta(x) &amp;= \prod_{i=1}^n \frac{\theta^{x_i}e^{-\theta}}{x_i!}\\[7pt]
&amp;= \underbrace{e^{\theta \left(\sum_i x_i\right) -n\theta}}_{g_\theta\left(\sum_i x_i\right)}\cdot \underbrace{\left(\prod_{i=1}^n x_i!\right)^{-1}}_{h(x)},
\end{aligned}
\]</span> Showing once again that <span class="math inline">\(T(X) = \sum_i X_i\)</span> is sufficient. As we’ll find out in the next lecture, there is a good reason why these calculations turned out so similarly: both of these models have what is called an <em>exponential family</em> structure.</p>
<p><strong>Example: Uniform location family</strong> As a third example, suppose we observe an i.i.d. sample from a uniform distribution on the interval <span class="math inline">\([\theta, \theta + 1]\)</span>:</p>
<p><span class="math display">\[
X_1,\ldots, X_n \simiid U[\theta, \theta+1] = 1\{\theta \leq x \leq \theta + 1\}.
\]</span> The joint density function for the full data set is</p>
<p><span class="math display">\[
p_\theta(x) = \prod_{i=1}^n 1\{\theta \leq x \leq \theta + 1} = 1\{\theta \leq \min_i x_i\} 1\{\max_i x_i \leq \theta + 1\},
\]</span> so <span class="math inline">\(T(X) = (\min_i X_i, \max_i X_i)\)</span> is sufficient.</p>
</section>
<section id="interpretations-of-sufficiency" class="level2">
<h2 class="anchored" data-anchor-id="interpretations-of-sufficiency">Interpretations of sufficiency</h2>
</section>
<section id="sufficient-statistics-under-i.i.d.-sampling" class="level2">
<h2 class="anchored" data-anchor-id="sufficient-statistics-under-i.i.d.-sampling">Sufficient statistics under i.i.d. sampling</h2>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb2" data-startfrom="551" data-source-offset="-25"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 550;"><span id="cb2-551"><a href="#cb2-551" aria-hidden="true" tabindex="-1"></a>viewof n2 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="dv">1</span><span class="op">,</span> <span class="dv">8</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="dv">4</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"n"</span>})</span>
<span id="cb2-552"><a href="#cb2-552" aria-hidden="true" tabindex="-1"></a>viewof theta2 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">range</span>([<span class="fl">0.01</span><span class="op">,</span> <span class="fl">0.99</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="fl">0.30</span><span class="op">,</span> <span class="dt">step</span><span class="op">:</span> <span class="fl">0.01</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"θ"</span>})</span>
<span id="cb2-553"><a href="#cb2-553" aria-hidden="true" tabindex="-1"></a><span class="co">// Method 3: Using a single combined input</span></span>
<span id="cb2-554"><a href="#cb2-554" aria-hidden="true" tabindex="-1"></a>viewof S <span class="op">=</span> {</span>
<span id="cb2-555"><a href="#cb2-555" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> form <span class="op">=</span> <span class="fu">html</span><span class="vs">`&lt;form style="font: 13px var(--sans-serif); display: flex; flex-direction: column; gap: 8px;"&gt;</span></span>
<span id="cb2-556"><a href="#cb2-556" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;div style="display: flex; align-items: center;"&gt;</span></span>
<span id="cb2-557"><a href="#cb2-557" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;label style="display: flex; align-items: center; gap: 0.5em; min-width: 180px;"&gt;</span></span>
<span id="cb2-558"><a href="#cb2-558" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;span style="width: 8em;"&gt;S₁ = s₁&lt;/span&gt;</span></span>
<span id="cb2-559"><a href="#cb2-559" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;input id="s1-text" type="number" min="0" max="</span><span class="sc">${</span>n2<span class="sc">}</span><span class="vs">" step="1" value="1" </span></span>
<span id="cb2-560"><a href="#cb2-560" aria-hidden="true" tabindex="-1"></a><span class="vs">               style="width: 5em; font: inherit;"&gt;</span></span>
<span id="cb2-561"><a href="#cb2-561" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;input name="s1" type="range" min="0" max="</span><span class="sc">${</span>n2<span class="sc">}</span><span class="vs">" step="1" value="1" </span></span>
<span id="cb2-562"><a href="#cb2-562" aria-hidden="true" tabindex="-1"></a><span class="vs">               style="flex: 1; margin-left: 0.5em;"&gt;</span></span>
<span id="cb2-563"><a href="#cb2-563" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/label&gt;</span></span>
<span id="cb2-564"><a href="#cb2-564" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/div&gt;</span></span>
<span id="cb2-565"><a href="#cb2-565" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;div style="display: flex; align-items: center;"&gt;</span></span>
<span id="cb2-566"><a href="#cb2-566" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;label style="display: flex; align-items: center; gap: 0.5em; min-width: 180px;"&gt;</span></span>
<span id="cb2-567"><a href="#cb2-567" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;span style="width: 8em;"&gt;S₂ = s₂&lt;/span&gt;</span></span>
<span id="cb2-568"><a href="#cb2-568" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;input id="s2-text" type="number" min="0" max="</span><span class="sc">${</span>n2<span class="sc">}</span><span class="vs">" step="1" value="3" </span></span>
<span id="cb2-569"><a href="#cb2-569" aria-hidden="true" tabindex="-1"></a><span class="vs">               style="width: 5em; font: inherit;"&gt;</span></span>
<span id="cb2-570"><a href="#cb2-570" aria-hidden="true" tabindex="-1"></a><span class="vs">        &lt;input name="s2" type="range" min="0" max="</span><span class="sc">${</span>n2<span class="sc">}</span><span class="vs">" step="1" value="3" </span></span>
<span id="cb2-571"><a href="#cb2-571" aria-hidden="true" tabindex="-1"></a><span class="vs">               style="flex: 1; margin-left: 0.5em;"&gt;</span></span>
<span id="cb2-572"><a href="#cb2-572" aria-hidden="true" tabindex="-1"></a><span class="vs">      &lt;/label&gt;</span></span>
<span id="cb2-573"><a href="#cb2-573" aria-hidden="true" tabindex="-1"></a><span class="vs">    &lt;/div&gt;</span></span>
<span id="cb2-574"><a href="#cb2-574" aria-hidden="true" tabindex="-1"></a><span class="vs">  &lt;/form&gt;`</span><span class="op">;</span></span>
<span id="cb2-575"><a href="#cb2-575" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-576"><a href="#cb2-576" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> s1Input <span class="op">=</span> form<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">'input[name="s1"]'</span>)<span class="op">;</span></span>
<span id="cb2-577"><a href="#cb2-577" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> s2Input <span class="op">=</span> form<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">'input[name="s2"]'</span>)<span class="op">;</span></span>
<span id="cb2-578"><a href="#cb2-578" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> s1TextInput <span class="op">=</span> form<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">'#s1-text'</span>)<span class="op">;</span></span>
<span id="cb2-579"><a href="#cb2-579" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> s2TextInput <span class="op">=</span> form<span class="op">.</span><span class="fu">querySelector</span>(<span class="st">'#s2-text'</span>)<span class="op">;</span></span>
<span id="cb2-580"><a href="#cb2-580" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-581"><a href="#cb2-581" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateConstraints</span>(changedInput) {</span>
<span id="cb2-582"><a href="#cb2-582" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> s1Val <span class="op">=</span> <span class="pp">parseFloat</span>(s1Input<span class="op">.</span><span class="at">value</span>)<span class="op">;</span></span>
<span id="cb2-583"><a href="#cb2-583" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> s2Val <span class="op">=</span> <span class="pp">parseFloat</span>(s2Input<span class="op">.</span><span class="at">value</span>)<span class="op">;</span></span>
<span id="cb2-584"><a href="#cb2-584" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-585"><a href="#cb2-585" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Enforce s1 &lt;= s2 by adjusting the input that wasn't changed</span></span>
<span id="cb2-586"><a href="#cb2-586" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (s1Val <span class="op">&gt;</span> s2Val) {</span>
<span id="cb2-587"><a href="#cb2-587" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (changedInput <span class="op">===</span> <span class="st">'s1'</span>) {</span>
<span id="cb2-588"><a href="#cb2-588" aria-hidden="true" tabindex="-1"></a>        <span class="co">// s1 was changed and went above s2, so adjust s2 up</span></span>
<span id="cb2-589"><a href="#cb2-589" aria-hidden="true" tabindex="-1"></a>        s2Input<span class="op">.</span><span class="at">value</span> <span class="op">=</span> s1Val<span class="op">;</span></span>
<span id="cb2-590"><a href="#cb2-590" aria-hidden="true" tabindex="-1"></a>        s2TextInput<span class="op">.</span><span class="at">value</span> <span class="op">=</span> s1Val<span class="op">;</span></span>
<span id="cb2-591"><a href="#cb2-591" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb2-592"><a href="#cb2-592" aria-hidden="true" tabindex="-1"></a>        <span class="co">// s2 was changed and went below s1, so adjust s1 down</span></span>
<span id="cb2-593"><a href="#cb2-593" aria-hidden="true" tabindex="-1"></a>        s1Input<span class="op">.</span><span class="at">value</span> <span class="op">=</span> s2Val<span class="op">;</span></span>
<span id="cb2-594"><a href="#cb2-594" aria-hidden="true" tabindex="-1"></a>        s1TextInput<span class="op">.</span><span class="at">value</span> <span class="op">=</span> s2Val<span class="op">;</span></span>
<span id="cb2-595"><a href="#cb2-595" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-596"><a href="#cb2-596" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-597"><a href="#cb2-597" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-598"><a href="#cb2-598" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update text displays to match sliders</span></span>
<span id="cb2-599"><a href="#cb2-599" aria-hidden="true" tabindex="-1"></a>    s1TextInput<span class="op">.</span><span class="at">value</span> <span class="op">=</span> s1Input<span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb2-600"><a href="#cb2-600" aria-hidden="true" tabindex="-1"></a>    s2TextInput<span class="op">.</span><span class="at">value</span> <span class="op">=</span> s2Input<span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb2-601"><a href="#cb2-601" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-602"><a href="#cb2-602" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update the form's value property for Observable</span></span>
<span id="cb2-603"><a href="#cb2-603" aria-hidden="true" tabindex="-1"></a>    form<span class="op">.</span><span class="at">value</span> <span class="op">=</span> {</span>
<span id="cb2-604"><a href="#cb2-604" aria-hidden="true" tabindex="-1"></a>      <span class="dt">s1</span><span class="op">:</span> <span class="pp">parseFloat</span>(s1Input<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb2-605"><a href="#cb2-605" aria-hidden="true" tabindex="-1"></a>      <span class="dt">s2</span><span class="op">:</span> <span class="pp">parseFloat</span>(s2Input<span class="op">.</span><span class="at">value</span>)</span>
<span id="cb2-606"><a href="#cb2-606" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb2-607"><a href="#cb2-607" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-608"><a href="#cb2-608" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Dispatch input event</span></span>
<span id="cb2-609"><a href="#cb2-609" aria-hidden="true" tabindex="-1"></a>    form<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">CustomEvent</span>(<span class="st">"input"</span>))<span class="op">;</span></span>
<span id="cb2-610"><a href="#cb2-610" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-611"><a href="#cb2-611" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-612"><a href="#cb2-612" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateFromText</span>(changedInput) {</span>
<span id="cb2-613"><a href="#cb2-613" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update slider from text input</span></span>
<span id="cb2-614"><a href="#cb2-614" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (changedInput <span class="op">===</span> <span class="st">'s1'</span>) {</span>
<span id="cb2-615"><a href="#cb2-615" aria-hidden="true" tabindex="-1"></a>      s1Input<span class="op">.</span><span class="at">value</span> <span class="op">=</span> s1TextInput<span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb2-616"><a href="#cb2-616" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb2-617"><a href="#cb2-617" aria-hidden="true" tabindex="-1"></a>      s2Input<span class="op">.</span><span class="at">value</span> <span class="op">=</span> s2TextInput<span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb2-618"><a href="#cb2-618" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-619"><a href="#cb2-619" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Then apply constraints</span></span>
<span id="cb2-620"><a href="#cb2-620" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateConstraints</span>(changedInput)<span class="op">;</span></span>
<span id="cb2-621"><a href="#cb2-621" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-622"><a href="#cb2-622" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-623"><a href="#cb2-623" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Listen to slider changes</span></span>
<span id="cb2-624"><a href="#cb2-624" aria-hidden="true" tabindex="-1"></a>  s1Input<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"input"</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="fu">updateConstraints</span>(<span class="st">'s1'</span>))<span class="op">;</span></span>
<span id="cb2-625"><a href="#cb2-625" aria-hidden="true" tabindex="-1"></a>  s2Input<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"input"</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="fu">updateConstraints</span>(<span class="st">'s2'</span>))<span class="op">;</span></span>
<span id="cb2-626"><a href="#cb2-626" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-627"><a href="#cb2-627" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Listen to text input changes</span></span>
<span id="cb2-628"><a href="#cb2-628" aria-hidden="true" tabindex="-1"></a>  s1TextInput<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"input"</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="fu">updateFromText</span>(<span class="st">'s1'</span>))<span class="op">;</span></span>
<span id="cb2-629"><a href="#cb2-629" aria-hidden="true" tabindex="-1"></a>  s2TextInput<span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"input"</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="fu">updateFromText</span>(<span class="st">'s2'</span>))<span class="op">;</span></span>
<span id="cb2-630"><a href="#cb2-630" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-631"><a href="#cb2-631" aria-hidden="true" tabindex="-1"></a>  <span class="fu">updateConstraints</span>(<span class="st">'s1'</span>)<span class="op">;</span> <span class="co">// Initialize</span></span>
<span id="cb2-632"><a href="#cb2-632" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-633"><a href="#cb2-633" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> form<span class="op">;</span></span>
<span id="cb2-634"><a href="#cb2-634" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-635"><a href="#cb2-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-636"><a href="#cb2-636" aria-hidden="true" tabindex="-1"></a><span class="co">// Extract x and y from range</span></span>
<span id="cb2-637"><a href="#cb2-637" aria-hidden="true" tabindex="-1"></a>s1_select <span class="op">=</span> S<span class="op">.</span><span class="at">s1</span></span>
<span id="cb2-638"><a href="#cb2-638" aria-hidden="true" tabindex="-1"></a>s2_select <span class="op">=</span> S<span class="op">.</span><span class="at">s2</span></span>
<span id="cb2-639"><a href="#cb2-639" aria-hidden="true" tabindex="-1"></a>viewof distributionType2 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">radio</span>([<span class="st">"Binomial"</span><span class="op">,</span> <span class="st">"Discrete Laplace"</span>]<span class="op">,</span> {<span class="dt">value</span><span class="op">:</span> <span class="st">"Binomial"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Distribution"</span>})</span>
<span id="cb2-640"><a href="#cb2-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-641"><a href="#cb2-641" aria-hidden="true" tabindex="-1"></a><span class="co">// Select which PMF to use based on dropdown selection</span></span>
<span id="cb2-642"><a href="#cb2-642" aria-hidden="true" tabindex="-1"></a>pmf2 <span class="op">=</span> distributionType2 <span class="op">===</span> <span class="st">"Binomial"</span> <span class="op">?</span> binomPMF <span class="op">:</span> expPMF</span>
<span id="cb2-643"><a href="#cb2-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-644"><a href="#cb2-644" aria-hidden="true" tabindex="-1"></a><span class="co">// Generate joint distribution data</span></span>
<span id="cb2-645"><a href="#cb2-645" aria-hidden="true" tabindex="-1"></a>jointData2 <span class="op">=</span> {</span>
<span id="cb2-646"><a href="#cb2-646" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb2-647"><a href="#cb2-647" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> x1 <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> x1 <span class="op">&lt;=</span> n2<span class="op">;</span> x1<span class="op">++</span>) {</span>
<span id="cb2-648"><a href="#cb2-648" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> x2 <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> x2 <span class="op">&lt;=</span> n2<span class="op">;</span> x2<span class="op">++</span>) {</span>
<span id="cb2-649"><a href="#cb2-649" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> prob <span class="op">=</span> <span class="fu">pmf</span>(x1<span class="op">,</span> n2<span class="op">,</span> theta2) <span class="op">*</span> <span class="fu">pmf</span>(x2<span class="op">,</span> n2<span class="op">,</span> theta2)<span class="op">;</span></span>
<span id="cb2-650"><a href="#cb2-650" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> x_min <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">min</span>(x1<span class="op">,</span> x2)<span class="op">;</span></span>
<span id="cb2-651"><a href="#cb2-651" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> x_max <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(x1<span class="op">,</span> x2)<span class="op">;</span></span>
<span id="cb2-652"><a href="#cb2-652" aria-hidden="true" tabindex="-1"></a>      data<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb2-653"><a href="#cb2-653" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x1</span><span class="op">:</span> x1<span class="op">,</span></span>
<span id="cb2-654"><a href="#cb2-654" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x2</span><span class="op">:</span> x2<span class="op">,</span></span>
<span id="cb2-655"><a href="#cb2-655" aria-hidden="true" tabindex="-1"></a>        <span class="dt">prob</span><span class="op">:</span> prob<span class="op">,</span></span>
<span id="cb2-656"><a href="#cb2-656" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x_min</span><span class="op">:</span> x_min<span class="op">,</span></span>
<span id="cb2-657"><a href="#cb2-657" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x_max</span><span class="op">:</span> x_max<span class="op">,</span></span>
<span id="cb2-658"><a href="#cb2-658" aria-hidden="true" tabindex="-1"></a>        <span class="dt">selected</span><span class="op">:</span> x_min <span class="op">===</span> s1_select <span class="op">&amp;&amp;</span> x_max <span class="op">===</span> s2_select</span>
<span id="cb2-659"><a href="#cb2-659" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb2-660"><a href="#cb2-660" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-661"><a href="#cb2-661" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-662"><a href="#cb2-662" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> data<span class="op">;</span></span>
<span id="cb2-663"><a href="#cb2-663" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-664"><a href="#cb2-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-665"><a href="#cb2-665" aria-hidden="true" tabindex="-1"></a><span class="co">// Generate conditional distribution data (X given T = t)</span></span>
<span id="cb2-666"><a href="#cb2-666" aria-hidden="true" tabindex="-1"></a>conditionalData2 <span class="op">=</span> {</span>
<span id="cb2-667"><a href="#cb2-667" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb2-668"><a href="#cb2-668" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> validPairs <span class="op">=</span> jointData2<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x_min</span> <span class="op">===</span> s1_select <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">x_max</span> <span class="op">===</span> s2_select)<span class="op">;</span></span>
<span id="cb2-669"><a href="#cb2-669" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalCondProb <span class="op">=</span> validPairs<span class="op">.</span><span class="fu">reduce</span>((sum<span class="op">,</span> d) <span class="kw">=&gt;</span> sum <span class="op">+</span> d<span class="op">.</span><span class="at">prob</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb2-670"><a href="#cb2-670" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-671"><a href="#cb2-671" aria-hidden="true" tabindex="-1"></a>  validPairs<span class="op">.</span><span class="fu">forEach</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb2-672"><a href="#cb2-672" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (totalCondProb <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb2-673"><a href="#cb2-673" aria-hidden="true" tabindex="-1"></a>      data<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb2-674"><a href="#cb2-674" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x1</span><span class="op">:</span> d<span class="op">.</span><span class="at">x1</span><span class="op">,</span></span>
<span id="cb2-675"><a href="#cb2-675" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x2</span><span class="op">:</span> d<span class="op">.</span><span class="at">x2</span><span class="op">,</span></span>
<span id="cb2-676"><a href="#cb2-676" aria-hidden="true" tabindex="-1"></a>        <span class="dt">condProb</span><span class="op">:</span> d<span class="op">.</span><span class="at">prob</span> <span class="op">/</span> totalCondProb<span class="op">,</span></span>
<span id="cb2-677"><a href="#cb2-677" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x_min</span><span class="op">:</span> d<span class="op">.</span><span class="at">x_min</span><span class="op">,</span></span>
<span id="cb2-678"><a href="#cb2-678" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x_max</span><span class="op">:</span> d<span class="op">.</span><span class="at">x_max</span></span>
<span id="cb2-679"><a href="#cb2-679" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb2-680"><a href="#cb2-680" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-681"><a href="#cb2-681" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb2-682"><a href="#cb2-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-683"><a href="#cb2-683" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> data<span class="op">;</span></span>
<span id="cb2-684"><a href="#cb2-684" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-685"><a href="#cb2-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-686"><a href="#cb2-686" aria-hidden="true" tabindex="-1"></a><span class="co">// Calculate maximum probability for scaling</span></span>
<span id="cb2-687"><a href="#cb2-687" aria-hidden="true" tabindex="-1"></a>maxProb2 <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="op">...</span>jointData2<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">prob</span>))</span>
<span id="cb2-688"><a href="#cb2-688" aria-hidden="true" tabindex="-1"></a>maxCondProb2 <span class="op">=</span> conditionalData2<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="op">...</span>conditionalData2<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">condProb</span>)) <span class="op">:</span> <span class="dv">1</span></span>
<span id="cb2-689"><a href="#cb2-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-690"><a href="#cb2-690" aria-hidden="true" tabindex="-1"></a><span class="co">// Generate marginal distributions</span></span>
<span id="cb2-691"><a href="#cb2-691" aria-hidden="true" tabindex="-1"></a>marginalX12 <span class="op">=</span> {</span>
<span id="cb2-692"><a href="#cb2-692" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb2-693"><a href="#cb2-693" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> x1 <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> x1 <span class="op">&lt;=</span> n2<span class="op">;</span> x1<span class="op">++</span>) {</span>
<span id="cb2-694"><a href="#cb2-694" aria-hidden="true" tabindex="-1"></a>    data<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb2-695"><a href="#cb2-695" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> x1<span class="op">,</span></span>
<span id="cb2-696"><a href="#cb2-696" aria-hidden="true" tabindex="-1"></a>      <span class="dt">prob</span><span class="op">:</span> <span class="fu">pmf</span>(x1<span class="op">,</span> n2<span class="op">,</span> theta2)</span>
<span id="cb2-697"><a href="#cb2-697" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb2-698"><a href="#cb2-698" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-699"><a href="#cb2-699" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> data<span class="op">;</span></span>
<span id="cb2-700"><a href="#cb2-700" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-701"><a href="#cb2-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-702"><a href="#cb2-702" aria-hidden="true" tabindex="-1"></a>marginalX22 <span class="op">=</span> {</span>
<span id="cb2-703"><a href="#cb2-703" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb2-704"><a href="#cb2-704" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> x2 <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> x2 <span class="op">&lt;=</span> n2<span class="op">;</span> x2<span class="op">++</span>) {</span>
<span id="cb2-705"><a href="#cb2-705" aria-hidden="true" tabindex="-1"></a>    data<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb2-706"><a href="#cb2-706" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> x2<span class="op">,</span></span>
<span id="cb2-707"><a href="#cb2-707" aria-hidden="true" tabindex="-1"></a>      <span class="dt">prob</span><span class="op">:</span> <span class="fu">pmf</span>(x2<span class="op">,</span> n2<span class="op">,</span> theta2)</span>
<span id="cb2-708"><a href="#cb2-708" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb2-709"><a href="#cb2-709" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-710"><a href="#cb2-710" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> data<span class="op">;</span></span>
<span id="cb2-711"><a href="#cb2-711" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-712"><a href="#cb2-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-713"><a href="#cb2-713" aria-hidden="true" tabindex="-1"></a><span class="co">// Generate conditional marginal distributions</span></span>
<span id="cb2-714"><a href="#cb2-714" aria-hidden="true" tabindex="-1"></a>conditionalMarginalX12 <span class="op">=</span> {</span>
<span id="cb2-715"><a href="#cb2-715" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb2-716"><a href="#cb2-716" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-717"><a href="#cb2-717" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (conditionalData2<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb2-718"><a href="#cb2-718" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Group by x1 and sum probabilities</span></span>
<span id="cb2-719"><a href="#cb2-719" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> x1Probs <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>()<span class="op">;</span></span>
<span id="cb2-720"><a href="#cb2-720" aria-hidden="true" tabindex="-1"></a>    conditionalData2<span class="op">.</span><span class="fu">forEach</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb2-721"><a href="#cb2-721" aria-hidden="true" tabindex="-1"></a>      x1Probs<span class="op">.</span><span class="fu">set</span>(d<span class="op">.</span><span class="at">x1</span><span class="op">,</span> (x1Probs<span class="op">.</span><span class="fu">get</span>(d<span class="op">.</span><span class="at">x1</span>) <span class="op">||</span> <span class="dv">0</span>) <span class="op">+</span> d<span class="op">.</span><span class="at">condProb</span>)<span class="op">;</span></span>
<span id="cb2-722"><a href="#cb2-722" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb2-723"><a href="#cb2-723" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-724"><a href="#cb2-724" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> x1 <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> x1 <span class="op">&lt;=</span> n2<span class="op">;</span> x1<span class="op">++</span>) {</span>
<span id="cb2-725"><a href="#cb2-725" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (x1Probs<span class="op">.</span><span class="fu">has</span>(x1)) {</span>
<span id="cb2-726"><a href="#cb2-726" aria-hidden="true" tabindex="-1"></a>        data<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb2-727"><a href="#cb2-727" aria-hidden="true" tabindex="-1"></a>          <span class="dt">x1</span><span class="op">:</span> x1<span class="op">,</span></span>
<span id="cb2-728"><a href="#cb2-728" aria-hidden="true" tabindex="-1"></a>          <span class="dt">prob</span><span class="op">:</span> x1Probs<span class="op">.</span><span class="fu">get</span>(x1)</span>
<span id="cb2-729"><a href="#cb2-729" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb2-730"><a href="#cb2-730" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-731"><a href="#cb2-731" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-732"><a href="#cb2-732" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-733"><a href="#cb2-733" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-734"><a href="#cb2-734" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> data<span class="op">;</span></span>
<span id="cb2-735"><a href="#cb2-735" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-736"><a href="#cb2-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-737"><a href="#cb2-737" aria-hidden="true" tabindex="-1"></a>conditionalMarginalX22 <span class="op">=</span> {</span>
<span id="cb2-738"><a href="#cb2-738" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb2-739"><a href="#cb2-739" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-740"><a href="#cb2-740" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (conditionalData2<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb2-741"><a href="#cb2-741" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Group by x2 and sum probabilities</span></span>
<span id="cb2-742"><a href="#cb2-742" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> x2Probs <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>()<span class="op">;</span></span>
<span id="cb2-743"><a href="#cb2-743" aria-hidden="true" tabindex="-1"></a>    conditionalData2<span class="op">.</span><span class="fu">forEach</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb2-744"><a href="#cb2-744" aria-hidden="true" tabindex="-1"></a>      x2Probs<span class="op">.</span><span class="fu">set</span>(d<span class="op">.</span><span class="at">x2</span><span class="op">,</span> (x2Probs<span class="op">.</span><span class="fu">get</span>(d<span class="op">.</span><span class="at">x2</span>) <span class="op">||</span> <span class="dv">0</span>) <span class="op">+</span> d<span class="op">.</span><span class="at">condProb</span>)<span class="op">;</span></span>
<span id="cb2-745"><a href="#cb2-745" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb2-746"><a href="#cb2-746" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-747"><a href="#cb2-747" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> x2 <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> x2 <span class="op">&lt;=</span> n2<span class="op">;</span> x2<span class="op">++</span>) {</span>
<span id="cb2-748"><a href="#cb2-748" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (x2Probs<span class="op">.</span><span class="fu">has</span>(x2)) {</span>
<span id="cb2-749"><a href="#cb2-749" aria-hidden="true" tabindex="-1"></a>        data<span class="op">.</span><span class="fu">push</span>({</span>
<span id="cb2-750"><a href="#cb2-750" aria-hidden="true" tabindex="-1"></a>          <span class="dt">x2</span><span class="op">:</span> x2<span class="op">,</span></span>
<span id="cb2-751"><a href="#cb2-751" aria-hidden="true" tabindex="-1"></a>          <span class="dt">prob</span><span class="op">:</span> x2Probs<span class="op">.</span><span class="fu">get</span>(x2)</span>
<span id="cb2-752"><a href="#cb2-752" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb2-753"><a href="#cb2-753" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-754"><a href="#cb2-754" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-755"><a href="#cb2-755" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-756"><a href="#cb2-756" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-757"><a href="#cb2-757" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> data<span class="op">;</span></span>
<span id="cb2-758"><a href="#cb2-758" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-759"><a href="#cb2-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-760"><a href="#cb2-760" aria-hidden="true" tabindex="-1"></a>maxRad2 <span class="op">=</span> <span class="dv">20</span> <span class="op">*</span> <span class="dv">5</span> <span class="op">/</span> (n2 <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb2-761"><a href="#cb2-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-762"><a href="#cb2-762" aria-hidden="true" tabindex="-1"></a>maxMarginalProb2 <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="op">...</span>marginalX12<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">prob</span>)<span class="op">,</span> <span class="op">...</span>marginalX22<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">prob</span>))</span>
<span id="cb2-763"><a href="#cb2-763" aria-hidden="true" tabindex="-1"></a>maxCondMarginalProb2 <span class="op">=</span> conditionalMarginalX12<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> conditionalMarginalX22<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> </span>
<span id="cb2-764"><a href="#cb2-764" aria-hidden="true" tabindex="-1"></a>  <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="op">...</span>conditionalMarginalX12<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">prob</span>)<span class="op">,</span> <span class="op">...</span>conditionalMarginalX22<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">prob</span>)) <span class="op">:</span> <span class="dv">1</span></span>
<span id="cb2-765"><a href="#cb2-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-766"><a href="#cb2-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-767"><a href="#cb2-767" aria-hidden="true" tabindex="-1"></a>jointPlot2 <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb2-768"><a href="#cb2-768" aria-hidden="true" tabindex="-1"></a>  <span class="dt">width</span><span class="op">:</span> <span class="dv">480</span><span class="op">,</span></span>
<span id="cb2-769"><a href="#cb2-769" aria-hidden="true" tabindex="-1"></a>  <span class="dt">height</span><span class="op">:</span> <span class="dv">480</span><span class="op">,</span></span>
<span id="cb2-770"><a href="#cb2-770" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marginTop</span><span class="op">:</span> <span class="dv">140</span><span class="op">,</span></span>
<span id="cb2-771"><a href="#cb2-771" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marginLeft</span><span class="op">:</span> <span class="dv">80</span><span class="op">,</span></span>
<span id="cb2-772"><a href="#cb2-772" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marginBottom</span><span class="op">:</span> <span class="dv">80</span><span class="op">,</span></span>
<span id="cb2-773"><a href="#cb2-773" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marginRight</span><span class="op">:</span> <span class="dv">120</span><span class="op">,</span></span>
<span id="cb2-774"><a href="#cb2-774" aria-hidden="true" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> { <span class="dt">fontSize</span><span class="op">:</span> <span class="st">"16px"</span> }<span class="op">,</span></span>
<span id="cb2-775"><a href="#cb2-775" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-776"><a href="#cb2-776" aria-hidden="true" tabindex="-1"></a>  <span class="dt">r</span><span class="op">:</span> {</span>
<span id="cb2-777"><a href="#cb2-777" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"linear"</span><span class="op">,</span></span>
<span id="cb2-778"><a href="#cb2-778" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> maxRad2]<span class="op">,</span>  <span class="co">// Fixed domain from 0 to 20</span></span>
<span id="cb2-779"><a href="#cb2-779" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> maxRad2]<span class="op">,</span>   <span class="co">// Maps directly to pixel sizes</span></span>
<span id="cb2-780"><a href="#cb2-780" aria-hidden="true" tabindex="-1"></a>    <span class="dt">clamp</span><span class="op">:</span> <span class="kw">true</span>       <span class="co">// Prevents values outside domain</span></span>
<span id="cb2-781"><a href="#cb2-781" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb2-782"><a href="#cb2-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-783"><a href="#cb2-783" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-784"><a href="#cb2-784" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb2-785"><a href="#cb2-785" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="op">-</span><span class="fl">0.5</span><span class="op">,</span> n2 <span class="op">+</span> <span class="fl">0.5</span>]<span class="op">,</span></span>
<span id="cb2-786"><a href="#cb2-786" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({<span class="dt">length</span><span class="op">:</span> n2 <span class="op">+</span> <span class="dv">1</span>}<span class="op">,</span> (_<span class="op">,</span> i) <span class="kw">=&gt;</span> i)<span class="op">,</span></span>
<span id="cb2-787"><a href="#cb2-787" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tickFormat</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="fu">toString</span>()<span class="op">,</span></span>
<span id="cb2-788"><a href="#cb2-788" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"X₁"</span><span class="op">,</span></span>
<span id="cb2-789"><a href="#cb2-789" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelAnchor</span><span class="op">:</span> <span class="st">"center"</span><span class="op">,</span></span>
<span id="cb2-790"><a href="#cb2-790" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelOffset</span><span class="op">:</span> <span class="dv">50</span></span>
<span id="cb2-791"><a href="#cb2-791" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb2-792"><a href="#cb2-792" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb2-793"><a href="#cb2-793" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="op">-</span><span class="fl">0.5</span><span class="op">,</span> n2 <span class="op">+</span> <span class="fl">0.5</span>]<span class="op">,</span></span>
<span id="cb2-794"><a href="#cb2-794" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({<span class="dt">length</span><span class="op">:</span> n2 <span class="op">+</span> <span class="dv">1</span>}<span class="op">,</span> (_<span class="op">,</span> i) <span class="kw">=&gt;</span> i)<span class="op">,</span></span>
<span id="cb2-795"><a href="#cb2-795" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tickFormat</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="fu">toString</span>()<span class="op">,</span></span>
<span id="cb2-796"><a href="#cb2-796" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"X₂"</span><span class="op">,</span></span>
<span id="cb2-797"><a href="#cb2-797" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelAnchor</span><span class="op">:</span> <span class="st">"center"</span><span class="op">,</span></span>
<span id="cb2-798"><a href="#cb2-798" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelOffset</span><span class="op">:</span> <span class="dv">50</span></span>
<span id="cb2-799"><a href="#cb2-799" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb2-800"><a href="#cb2-800" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-801"><a href="#cb2-801" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb2-802"><a href="#cb2-802" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Grid lines</span></span>
<span id="cb2-803"><a href="#cb2-803" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleX</span>(<span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({<span class="dt">length</span><span class="op">:</span> n2 <span class="op">+</span> <span class="dv">1</span>}<span class="op">,</span> (_<span class="op">,</span> i) <span class="kw">=&gt;</span> i)<span class="op">,</span> {<span class="dt">stroke</span><span class="op">:</span> <span class="st">"#f0f0f0"</span>})<span class="op">,</span></span>
<span id="cb2-804"><a href="#cb2-804" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleY</span>(<span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({<span class="dt">length</span><span class="op">:</span> n2 <span class="op">+</span> <span class="dv">1</span>}<span class="op">,</span> (_<span class="op">,</span> i) <span class="kw">=&gt;</span> i)<span class="op">,</span> {<span class="dt">stroke</span><span class="op">:</span> <span class="st">"#f0f0f0"</span>})<span class="op">,</span></span>
<span id="cb2-805"><a href="#cb2-805" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-806"><a href="#cb2-806" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Probability circles</span></span>
<span id="cb2-807"><a href="#cb2-807" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dot</span>(jointData2<span class="op">,</span> {</span>
<span id="cb2-808"><a href="#cb2-808" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x1"</span><span class="op">,</span> </span>
<span id="cb2-809"><a href="#cb2-809" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"x2"</span><span class="op">,</span> </span>
<span id="cb2-810"><a href="#cb2-810" aria-hidden="true" tabindex="-1"></a>      <span class="dt">r</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(d<span class="op">.</span><span class="at">prob</span> <span class="op">/</span> maxProb2) <span class="op">*</span> maxRad2<span class="op">,</span>   </span>
<span id="cb2-811"><a href="#cb2-811" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">selected</span> <span class="op">?</span> <span class="st">"red"</span> <span class="op">:</span> <span class="st">"steelblue"</span><span class="op">,</span></span>
<span id="cb2-812"><a href="#cb2-812" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.7</span><span class="op">,</span></span>
<span id="cb2-813"><a href="#cb2-813" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb2-814"><a href="#cb2-814" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">0.5</span></span>
<span id="cb2-815"><a href="#cb2-815" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb2-816"><a href="#cb2-816" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-817"><a href="#cb2-817" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Top marginal histogram (X₁)</span></span>
<span id="cb2-818"><a href="#cb2-818" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(marginalX12<span class="op">,</span> {</span>
<span id="cb2-819"><a href="#cb2-819" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x1</span> <span class="op">-</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb2-820"><a href="#cb2-820" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x1</span> <span class="op">+</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb2-821"><a href="#cb2-821" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> n2 <span class="op">+</span> <span class="fl">0.56</span> <span class="op">+</span> n2 <span class="op">*</span> <span class="op">.</span><span class="bn">06</span><span class="op">,</span></span>
<span id="cb2-822"><a href="#cb2-822" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> n2 <span class="op">+</span> <span class="fl">0.56</span> <span class="op">+</span> n2 <span class="op">*</span> <span class="op">.</span><span class="bn">06</span> <span class="op">+</span> (d<span class="op">.</span><span class="at">prob</span> <span class="op">/</span> maxMarginalProb2) <span class="op">*</span> (n2 <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb2-823"><a href="#cb2-823" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"steelblue"</span><span class="op">,</span></span>
<span id="cb2-824"><a href="#cb2-824" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.7</span><span class="op">,</span></span>
<span id="cb2-825"><a href="#cb2-825" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb2-826"><a href="#cb2-826" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">0.5</span></span>
<span id="cb2-827"><a href="#cb2-827" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb2-828"><a href="#cb2-828" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-829"><a href="#cb2-829" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Right marginal histogram (X₂)</span></span>
<span id="cb2-830"><a href="#cb2-830" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(marginalX22<span class="op">,</span> {</span>
<span id="cb2-831"><a href="#cb2-831" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> n2 <span class="op">+</span> <span class="fl">0.56</span> <span class="op">+</span> n2 <span class="op">*</span> <span class="op">.</span><span class="bn">06</span><span class="op">,</span></span>
<span id="cb2-832"><a href="#cb2-832" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> n2 <span class="op">+</span> <span class="fl">0.56</span> <span class="op">+</span> n2 <span class="op">*</span> <span class="op">.</span><span class="bn">06</span> <span class="op">+</span> (d<span class="op">.</span><span class="at">prob</span> <span class="op">/</span> maxMarginalProb2) <span class="op">*</span> (n2 <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb2-833"><a href="#cb2-833" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x2</span> <span class="op">-</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb2-834"><a href="#cb2-834" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x2</span> <span class="op">+</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb2-835"><a href="#cb2-835" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"steelblue"</span><span class="op">,</span></span>
<span id="cb2-836"><a href="#cb2-836" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.7</span><span class="op">,</span></span>
<span id="cb2-837"><a href="#cb2-837" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb2-838"><a href="#cb2-838" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">0.5</span></span>
<span id="cb2-839"><a href="#cb2-839" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb2-840"><a href="#cb2-840" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-841"><a href="#cb2-841" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Title</span></span>
<span id="cb2-842"><a href="#cb2-842" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>([<span class="st">"Joint Distribution of X = (X₁, X₂)"</span>]<span class="op">,</span> {</span>
<span id="cb2-843"><a href="#cb2-843" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> n2<span class="op">/</span><span class="dv">2</span><span class="op">,</span> </span>
<span id="cb2-844"><a href="#cb2-844" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> n2 <span class="op">+</span> <span class="fl">0.5</span> <span class="op">+</span> (n2 <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> <span class="op">.</span><span class="dv">45</span><span class="op">,</span> </span>
<span id="cb2-845"><a href="#cb2-845" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">24</span><span class="op">,</span> </span>
<span id="cb2-846"><a href="#cb2-846" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb2-847"><a href="#cb2-847" aria-hidden="true" tabindex="-1"></a>      <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"middle"</span></span>
<span id="cb2-848"><a href="#cb2-848" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb2-849"><a href="#cb2-849" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb2-850"><a href="#cb2-850" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb2-851"><a href="#cb2-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-852"><a href="#cb2-852" aria-hidden="true" tabindex="-1"></a>conditionalPlot2 <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb2-853"><a href="#cb2-853" aria-hidden="true" tabindex="-1"></a>  <span class="dt">width</span><span class="op">:</span> <span class="dv">480</span><span class="op">,</span></span>
<span id="cb2-854"><a href="#cb2-854" aria-hidden="true" tabindex="-1"></a>  <span class="dt">height</span><span class="op">:</span> <span class="dv">480</span><span class="op">,</span></span>
<span id="cb2-855"><a href="#cb2-855" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marginTop</span><span class="op">:</span> <span class="dv">140</span><span class="op">,</span></span>
<span id="cb2-856"><a href="#cb2-856" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marginLeft</span><span class="op">:</span> <span class="dv">80</span><span class="op">,</span></span>
<span id="cb2-857"><a href="#cb2-857" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marginBottom</span><span class="op">:</span> <span class="dv">80</span><span class="op">,</span></span>
<span id="cb2-858"><a href="#cb2-858" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marginRight</span><span class="op">:</span> <span class="dv">120</span><span class="op">,</span></span>
<span id="cb2-859"><a href="#cb2-859" aria-hidden="true" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> { <span class="dt">fontSize</span><span class="op">:</span> <span class="st">"16px"</span> }<span class="op">,</span></span>
<span id="cb2-860"><a href="#cb2-860" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-861"><a href="#cb2-861" aria-hidden="true" tabindex="-1"></a>  <span class="dt">r</span><span class="op">:</span> {</span>
<span id="cb2-862"><a href="#cb2-862" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> <span class="st">"linear"</span><span class="op">,</span></span>
<span id="cb2-863"><a href="#cb2-863" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> maxRad2]<span class="op">,</span>  <span class="co">// Fixed domain from 0 to 20</span></span>
<span id="cb2-864"><a href="#cb2-864" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> maxRad2]<span class="op">,</span>   <span class="co">// Maps directly to pixel   sizes  </span></span>
<span id="cb2-865"><a href="#cb2-865" aria-hidden="true" tabindex="-1"></a>    <span class="dt">clamp</span><span class="op">:</span> <span class="kw">false</span>       <span class="co">// Prevents values outside domain</span></span>
<span id="cb2-866"><a href="#cb2-866" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb2-867"><a href="#cb2-867" aria-hidden="true" tabindex="-1"></a>  <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb2-868"><a href="#cb2-868" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="op">-</span><span class="fl">0.5</span><span class="op">,</span> n2 <span class="op">+</span> <span class="fl">0.5</span>]<span class="op">,</span></span>
<span id="cb2-869"><a href="#cb2-869" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({<span class="dt">length</span><span class="op">:</span> n2 <span class="op">+</span> <span class="dv">1</span>}<span class="op">,</span> (_<span class="op">,</span> i) <span class="kw">=&gt;</span> i)<span class="op">,</span></span>
<span id="cb2-870"><a href="#cb2-870" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tickFormat</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="fu">toString</span>()<span class="op">,</span></span>
<span id="cb2-871"><a href="#cb2-871" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"X₁"</span><span class="op">,</span></span>
<span id="cb2-872"><a href="#cb2-872" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelAnchor</span><span class="op">:</span> <span class="st">"center"</span><span class="op">,</span></span>
<span id="cb2-873"><a href="#cb2-873" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelOffset</span><span class="op">:</span> <span class="dv">50</span></span>
<span id="cb2-874"><a href="#cb2-874" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb2-875"><a href="#cb2-875" aria-hidden="true" tabindex="-1"></a>  <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb2-876"><a href="#cb2-876" aria-hidden="true" tabindex="-1"></a>    <span class="dt">domain</span><span class="op">:</span> [<span class="op">-</span><span class="fl">0.5</span><span class="op">,</span> n2 <span class="op">+</span> <span class="fl">0.5</span>]<span class="op">,</span></span>
<span id="cb2-877"><a href="#cb2-877" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ticks</span><span class="op">:</span> <span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({<span class="dt">length</span><span class="op">:</span> n2 <span class="op">+</span> <span class="dv">1</span>}<span class="op">,</span> (_<span class="op">,</span> i) <span class="kw">=&gt;</span> i)<span class="op">,</span></span>
<span id="cb2-878"><a href="#cb2-878" aria-hidden="true" tabindex="-1"></a>    <span class="dt">tickFormat</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="fu">toString</span>()<span class="op">,</span></span>
<span id="cb2-879"><a href="#cb2-879" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="st">"X₂"</span><span class="op">,</span></span>
<span id="cb2-880"><a href="#cb2-880" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelAnchor</span><span class="op">:</span> <span class="st">"center"</span><span class="op">,</span></span>
<span id="cb2-881"><a href="#cb2-881" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelOffset</span><span class="op">:</span> <span class="dv">50</span></span>
<span id="cb2-882"><a href="#cb2-882" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb2-883"><a href="#cb2-883" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-884"><a href="#cb2-884" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb2-885"><a href="#cb2-885" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Grid lines</span></span>
<span id="cb2-886"><a href="#cb2-886" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleX</span>(<span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({<span class="dt">length</span><span class="op">:</span> n2 <span class="op">+</span> <span class="dv">1</span>}<span class="op">,</span> (_<span class="op">,</span> i) <span class="kw">=&gt;</span> i)<span class="op">,</span> {<span class="dt">stroke</span><span class="op">:</span> <span class="st">"#f0f0f0"</span>})<span class="op">,</span></span>
<span id="cb2-887"><a href="#cb2-887" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleY</span>(<span class="bu">Array</span><span class="op">.</span><span class="fu">from</span>({<span class="dt">length</span><span class="op">:</span> n2 <span class="op">+</span> <span class="dv">1</span>}<span class="op">,</span> (_<span class="op">,</span> i) <span class="kw">=&gt;</span> i)<span class="op">,</span> {<span class="dt">stroke</span><span class="op">:</span> <span class="st">"#f0f0f0"</span>})<span class="op">,</span></span>
<span id="cb2-888"><a href="#cb2-888" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-889"><a href="#cb2-889" aria-hidden="true" tabindex="-1"></a>    <span class="co">// All possible points (faded)</span></span>
<span id="cb2-890"><a href="#cb2-890" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dot</span>(jointData2<span class="op">,</span> {</span>
<span id="cb2-891"><a href="#cb2-891" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x1"</span><span class="op">,</span> </span>
<span id="cb2-892"><a href="#cb2-892" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"x2"</span><span class="op">,</span> </span>
<span id="cb2-893"><a href="#cb2-893" aria-hidden="true" tabindex="-1"></a>      <span class="dt">r</span><span class="op">:</span> <span class="dv">3</span><span class="op">,</span></span>
<span id="cb2-894"><a href="#cb2-894" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"lightgray"</span><span class="op">,</span></span>
<span id="cb2-895"><a href="#cb2-895" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.3</span></span>
<span id="cb2-896"><a href="#cb2-896" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb2-897"><a href="#cb2-897" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-898"><a href="#cb2-898" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Conditional probability circles</span></span>
<span id="cb2-899"><a href="#cb2-899" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dot</span>(conditionalData2<span class="op">,</span> {</span>
<span id="cb2-900"><a href="#cb2-900" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> <span class="st">"x1"</span><span class="op">,</span> </span>
<span id="cb2-901"><a href="#cb2-901" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> <span class="st">"x2"</span><span class="op">,</span> </span>
<span id="cb2-902"><a href="#cb2-902" aria-hidden="true" tabindex="-1"></a>      <span class="dt">r</span><span class="op">:</span> d <span class="kw">=&gt;</span> conditionalData2<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span>(d<span class="op">.</span><span class="at">condProb</span> <span class="op">/</span> maxCondProb2) <span class="op">*</span> maxRad2 <span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb2-903"><a href="#cb2-903" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"red"</span><span class="op">,</span></span>
<span id="cb2-904"><a href="#cb2-904" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.8</span><span class="op">,</span></span>
<span id="cb2-905"><a href="#cb2-905" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb2-906"><a href="#cb2-906" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="dv">1</span></span>
<span id="cb2-907"><a href="#cb2-907" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb2-908"><a href="#cb2-908" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-909"><a href="#cb2-909" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Top conditional marginal histogram (X₁ | T = t)</span></span>
<span id="cb2-910"><a href="#cb2-910" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(conditionalMarginalX12<span class="op">,</span> {</span>
<span id="cb2-911"><a href="#cb2-911" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x1</span> <span class="op">-</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb2-912"><a href="#cb2-912" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x1</span> <span class="op">+</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb2-913"><a href="#cb2-913" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> n2 <span class="op">+</span> <span class="fl">0.56</span> <span class="op">+</span> n2 <span class="op">*</span> <span class="op">.</span><span class="bn">06</span><span class="op">,</span></span>
<span id="cb2-914"><a href="#cb2-914" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> n2 <span class="op">+</span> <span class="fl">0.56</span> <span class="op">+</span> n2 <span class="op">*</span> <span class="op">.</span><span class="bn">06</span> <span class="op">+</span> (d<span class="op">.</span><span class="at">prob</span> <span class="op">/</span> maxCondMarginalProb2) <span class="op">*</span> (n2 <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb2-915"><a href="#cb2-915" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"red"</span><span class="op">,</span></span>
<span id="cb2-916"><a href="#cb2-916" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.7</span><span class="op">,</span></span>
<span id="cb2-917"><a href="#cb2-917" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb2-918"><a href="#cb2-918" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">0.5</span></span>
<span id="cb2-919"><a href="#cb2-919" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb2-920"><a href="#cb2-920" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-921"><a href="#cb2-921" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Right conditional marginal histogram (X₂ | S = s)</span></span>
<span id="cb2-922"><a href="#cb2-922" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">rect</span>(conditionalMarginalX22<span class="op">,</span> {</span>
<span id="cb2-923"><a href="#cb2-923" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x1</span><span class="op">:</span> n2 <span class="op">+</span> <span class="fl">0.56</span> <span class="op">+</span> n2 <span class="op">*</span> <span class="op">.</span><span class="bn">06</span><span class="op">,</span></span>
<span id="cb2-924"><a href="#cb2-924" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x2</span><span class="op">:</span> d <span class="kw">=&gt;</span> n2 <span class="op">+</span> <span class="fl">0.56</span> <span class="op">+</span> n2 <span class="op">*</span> <span class="op">.</span><span class="bn">06</span> <span class="op">+</span> (d<span class="op">.</span><span class="at">prob</span> <span class="op">/</span> maxCondMarginalProb2) <span class="op">*</span> (n2 <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb2-925"><a href="#cb2-925" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y1</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x2</span> <span class="op">-</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb2-926"><a href="#cb2-926" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y2</span><span class="op">:</span> d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">x2</span> <span class="op">+</span> <span class="fl">0.3</span><span class="op">,</span></span>
<span id="cb2-927"><a href="#cb2-927" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fill</span><span class="op">:</span> <span class="st">"red"</span><span class="op">,</span></span>
<span id="cb2-928"><a href="#cb2-928" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.7</span><span class="op">,</span></span>
<span id="cb2-929"><a href="#cb2-929" aria-hidden="true" tabindex="-1"></a>      <span class="dt">stroke</span><span class="op">:</span> <span class="st">"black"</span><span class="op">,</span></span>
<span id="cb2-930"><a href="#cb2-930" aria-hidden="true" tabindex="-1"></a>      <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">0.5</span></span>
<span id="cb2-931"><a href="#cb2-931" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb2-932"><a href="#cb2-932" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-933"><a href="#cb2-933" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Title</span></span>
<span id="cb2-934"><a href="#cb2-934" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">text</span>([<span class="vs">`Conditional Distribution P(X | S = (</span><span class="sc">${</span>s1_select<span class="sc">}</span><span class="vs">, </span><span class="sc">${</span>s2_select<span class="sc">}</span><span class="vs">))`</span>]<span class="op">,</span> {</span>
<span id="cb2-935"><a href="#cb2-935" aria-hidden="true" tabindex="-1"></a>      <span class="dt">x</span><span class="op">:</span> n2<span class="op">/</span><span class="dv">2</span><span class="op">,</span> </span>
<span id="cb2-936"><a href="#cb2-936" aria-hidden="true" tabindex="-1"></a>      <span class="dt">y</span><span class="op">:</span> n2 <span class="op">+</span> <span class="fl">0.5</span> <span class="op">+</span> (n2 <span class="op">+</span> <span class="dv">1</span>) <span class="op">*</span> <span class="op">.</span><span class="dv">45</span><span class="op">,</span> </span>
<span id="cb2-937"><a href="#cb2-937" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontSize</span><span class="op">:</span> <span class="dv">24</span><span class="op">,</span> </span>
<span id="cb2-938"><a href="#cb2-938" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb2-939"><a href="#cb2-939" aria-hidden="true" tabindex="-1"></a>      <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"middle"</span></span>
<span id="cb2-940"><a href="#cb2-940" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb2-941"><a href="#cb2-941" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb2-942"><a href="#cb2-942" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb2-943"><a href="#cb2-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-944"><a href="#cb2-944" aria-hidden="true" tabindex="-1"></a><span class="co">// Display plots side by side</span></span>
<span id="cb2-945"><a href="#cb2-945" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`&lt;div style="display: flex; gap: 20px; align-items: center; justify-content: center;"&gt;</span></span>
<span id="cb2-946"><a href="#cb2-946" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span><span class="sc">${</span>jointPlot2<span class="sc">}</span></span>
<span id="cb2-947"><a href="#cb2-947" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span><span class="sc">${</span>conditionalPlot2<span class="sc">}</span></span>
<span id="cb2-948"><a href="#cb2-948" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;/div&gt;`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-4" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-13" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-14" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-15" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-16" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-17" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-18" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-19" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-20" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-21" data-nodetype="expression">

</div>
</div>
</div>
</div>
</section>
<section id="minimal-sufficiency" class="level2">
<h2 class="anchored" data-anchor-id="minimal-sufficiency">Minimal sufficiency</h2>
<p>Consider again the example with <span class="math inline">\(X_1,\ldots,X_n \simiid N(\theta,1)\)</span>. We have shown that <span class="math inline">\(\sum_i X_i\)</span> is sufficient. It follows that <span class="math inline">\(\overline{X} = \frac{1}{n}\sum_i X_i\)</span> is also sufficient. But we have also shown that the vector of order statistics <span class="math inline">\(S(X) = (X_{(1)}, \ldots, X_{(n)})\)</span> is another sufficient statistic. Finally, the full data set <span class="math inline">\(X\)</span> is always a sufficient statistic, by definition.</p>
<p>While these are indeed all sufficient statistics, some of them represent more significant compressions of the data than others. We can see this from the fact that <span class="math inline">\(\sum_i X_i\)</span> and <span class="math inline">\(\overline{X}\)</span> are recoverable from each other, and can also be recovered from either <span class="math inline">\(S(X)\)</span> or <span class="math inline">\(X\)</span> itself, but <span class="math inline">\(S(X)\)</span> cannot be recovered from <span class="math inline">\(\sum_i X_i\)</span> or <span class="math inline">\(\overline{X}\)</span>. The full data <span class="math inline">\(X\)</span> cannot be recovered from any of the other three, but any of the other three can be recovered from it. Among these statistics, the first two represent the greatest reduction of the data, and <span class="math inline">\(X\)</span> represents no reduction at all, while <span class="math inline">\(S(X)\)</span> sits in the middle.</p>
<p>Any statistic from which a sufficient statistic can be recovered is immediately a sufficient statistic:</p>
<p><strong>Proposition:</strong> If <span class="math inline">\(T(X)\)</span> is sufficient and <span class="math inline">\(T(X) = f(S(X))\)</span> then <span class="math inline">\(S(X)\)</span> is also sufficient.</p>
<p><em>Proof:</em> By the factorization theorem we can find densities with <span class="math display">\[
p_\theta(x) = g_\theta(T(x))h(x) = (g_\theta \circ f)(S(x)) h(x),
\]</span> showing that <span class="math inline">\(S(X)\)</span> is sufficient as well.</p>
<p>We say that a sufficient statistic is <strong>minimal</strong> if it can be recovered from any other sufficient statistic. That is, <span class="math inline">\(T(X)\)</span> is <strong>minimal sufficient</strong> if</p>
<ol type="1">
<li><p><span class="math inline">\(T(X)\)</span> is sufficient, and</p></li>
<li><p>For any other sufficient statistic <span class="math inline">\(S(X)\)</span>, we have <span class="math inline">\(T(X) = f(S(X))\)</span> for some <span class="math inline">\(f\)</span> (almost surely in <span class="math inline">\(\cP\)</span>).</p></li>
</ol>
<p>We would like to be able to recognize minimal sufficient statistics when we can. For a model <span class="math inline">\(\cP\)</span> with densities <span class="math inline">\(p_\theta\)</span>, we can say that two data sets <span class="math inline">\(x,y\in \cX\)</span> are <em>equivalent</em> (with respect to statistical inference in <span class="math inline">\(\cP\)</span>) if <span class="math inline">\(p_\theta(x)/p_\theta(y)\)</span> does not depend on <span class="math inline">\(\theta\)</span>. We can write <span class="math inline">\(x \equiv_{\cP} y\)</span> if this is the case.</p>
<p>Note that, for any sufficient statistic <span class="math inline">\(T(X)\)</span>, values that map to the same output value <span class="math inline">\(t\)</span> must be equivalent: if <span class="math inline">\(T(x)=T(y)=t\)</span>, we have <span class="math display">\[
\frac{p_\theta(x)}{p_\theta(y)} = \frac{\PP_\theta(X = x \text{ and } T(X) = t)}{\PP_\theta(X = y \text{ and } T(X) = t)} = \frac{\PP(X = x \mid T(X) = t)}{\PP(X = y \mid T(X) = t)},
\]</span> which does not depend on <span class="math inline">\(\theta\)</span> by sufficiency of <span class="math inline">\(T(X)\)</span>. Thus, for <em>any</em> sufficient statistic we have <span class="math inline">\(T(x) = T(y) \Rightarrow x \equiv_{\cP} y\)</span>: the function <span class="math inline">\(T\)</span> is only allowed to collapse values that are equivalent to each other. For a <em>minimal sufficient statistic</em>, this implication goes both ways since <span class="math inline">\(T\)</span> collapses the sample space as much as possible. That is,</p>
<p><strong>Proposition:</strong> Assume <span class="math inline">\(\cP\)</span> has densities <span class="math inline">\(p_\theta(x)\)</span>, and <span class="math inline">\(T(X)\)</span> is any statistic. If we have <span class="math display">\[x \equiv_{\cP} y \iff T(x) = T(y),\]</span> then <span class="math inline">\(T(X)\)</span> is minimal sufficient.</p>
<p><em>Proof (discrete</em> <span class="math inline">\(\cX\)</span>): First, we show <span class="math inline">\(T(X)\)</span> is sufficient. For any <span class="math inline">\(x\)</span> with <span class="math inline">\(T(x) = t\)</span>, we have</p>
<p><span class="math display">\[
\PP_\theta(X = x \mid T(X) = t) = \frac{p_\theta(x)}{\sum_{z: T(z) = t} p_\theta(z)} = \frac{1}{\sum_{z:\; T(z) = t} p_\theta(z)/p_\theta(x)},
\]</span> which does not depend on <span class="math inline">\(\theta\)</span> because all of the values <span class="math inline">\(z\)</span> that we sum over in the denominator map to the same <span class="math inline">\(t\)</span>, and are therefore equivalent to <span class="math inline">\(x\)</span> by assumption.</p>
<p>Next, assume <span class="math inline">\(S(X)\)</span> is any other sufficient statistic. If <span class="math inline">\(S(x) = S(y) = s\)</span>, then <span class="math inline">\(x \equiv_{\cP} y\)</span>, by the argument above the theorem, and consequently <span class="math inline">\(T(x) = T(y)\)</span> by assumption. Then we can set <span class="math inline">\(f(s) = T(x)\)</span>. For any other value <span class="math inline">\(z\)</span> with <span class="math inline">\(S(z) = s\)</span>, we must also have <span class="math inline">\(x \equiv_{\cP} z\)</span> so <span class="math inline">\(T(z) = T(x) = f(S(z))\)</span>. Since <span class="math inline">\(s\)</span> was arbitrary, we have the result.</p>


</section>

</main> <!-- /main -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlxuLy8gQmlub21pYWwgcHJvYmFiaWxpdHkgbWFzcyBmdW5jdGlvblxuYmlub21QTUYgPSAoaywgbiwgcCkgPT4ge1xuICBpZiAoayA8IDAgfHwgayA+IG4pIHJldHVybiAwO1xuICBjb25zdCBiaW5vbUNvZWZmID0gZmFjdG9yaWFsKG4pIC8gKGZhY3RvcmlhbChrKSAqIGZhY3RvcmlhbChuIC0gaykpO1xuICByZXR1cm4gYmlub21Db2VmZiAqIE1hdGgucG93KHAsIGspICogTWF0aC5wb3coMSAtIHAsIG4gLSBrKTtcbn1cblxuLy8gRXhwb25lbnRpYWwtYmFzZWQgcHJvYmFiaWxpdHkgbWFzcyBmdW5jdGlvblxuZXhwUE1GID0gKGssIG4sIHRoZXRhKSA9PiB7XG4gIGlmIChrIDwgMCB8fCBrID4gbikgcmV0dXJuIDA7XG4gIC8vIENhbGN1bGF0ZSB1bm5vcm1hbGl6ZWQgcHJvYmFiaWxpdGllc1xuICBjb25zdCB1bm5vcm1hbGl6ZWQgPSBbXTtcbiAgbGV0IHN1bSA9IDA7XG4gIGZvciAobGV0IGkgPSAwOyBpIDw9IG47IGkrKykge1xuICAgIGNvbnN0IHZhbCA9IE1hdGguZXhwKC1NYXRoLmFicyhpIC0gbiAqIHRoZXRhKSk7XG4gICAgdW5ub3JtYWxpemVkLnB1c2godmFsKTtcbiAgICBzdW0gKz0gdmFsO1xuICB9XG4gIC8vIFJldHVybiBub3JtYWxpemVkIHByb2JhYmlsaXR5XG4gIHJldHVybiB1bm5vcm1hbGl6ZWRba10gLyBzdW07XG59XG5cbi8vIEZhY3RvcmlhbCBmdW5jdGlvbiB3aXRoIG1lbW9pemF0aW9uXG5mYWN0b3JpYWwgPSAobikgPT4ge1xuICBpZiAobiA8PSAxKSByZXR1cm4gMTtcbiAgbGV0IHJlc3VsdCA9IDE7XG4gIGZvciAobGV0IGkgPSAyOyBpIDw9IG47IGkrKykge1xuICAgIHJlc3VsdCAqPSBpO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbi8vIEludGVyYWN0aXZlIGNvbnRyb2xzXG52aWV3b2YgbiA9IElucHV0cy5yYW5nZShbMSwgOF0sIHt2YWx1ZTogNCwgc3RlcDogMSwgbGFiZWw6IFwiblwifSlcbnZpZXdvZiB0aGV0YSA9IElucHV0cy5yYW5nZShbMC4wMSwgMC45OV0sIHt2YWx1ZTogMC4zMCwgc3RlcDogMC4wMSwgbGFiZWw6IFwizrhcIn0pXG52aWV3b2YgdF9zZWxlY3QgPSBJbnB1dHMucmFuZ2UoWzAsIDIqbl0sIHt2YWx1ZTogTWF0aC5taW4oMywgMipuKSwgc3RlcDogMSwgbGFiZWw6IFwiVCA9IHRcIn0pXG52aWV3b2YgZGlzdHJpYnV0aW9uVHlwZSA9IElucHV0cy5yYWRpbyhbXCJCaW5vbWlhbFwiLCBcIkRpc2NyZXRlIExhcGxhY2VcIl0sIHt2YWx1ZTogXCJCaW5vbWlhbFwiLCBsYWJlbDogXCJEaXN0cmlidXRpb25cIn0pXG5cbi8vIFNlbGVjdCB3aGljaCBQTUYgdG8gdXNlIGJhc2VkIG9uIGRyb3Bkb3duIHNlbGVjdGlvblxucG1mID0gZGlzdHJpYnV0aW9uVHlwZSA9PT0gXCJCaW5vbWlhbFwiID8gYmlub21QTUYgOiBleHBQTUZcblxuLy8gR2VuZXJhdGUgam9pbnQgZGlzdHJpYnV0aW9uIGRhdGFcbmpvaW50RGF0YSA9IHtcbiAgY29uc3QgZGF0YSA9IFtdO1xuICBmb3IgKGxldCB4MSA9IDA7IHgxIDw9IG47IHgxKyspIHtcbiAgICBmb3IgKGxldCB4MiA9IDA7IHgyIDw9IG47IHgyKyspIHtcbiAgICAgIGNvbnN0IHByb2IgPSBwbWYoeDEsIG4sIHRoZXRhKSAqIHBtZih4MiwgbiwgdGhldGEpO1xuICAgICAgY29uc3QgdCA9IHgxICsgeDI7XG4gICAgICBkYXRhLnB1c2goe1xuICAgICAgICB4MTogeDEsXG4gICAgICAgIHgyOiB4MixcbiAgICAgICAgcHJvYjogcHJvYixcbiAgICAgICAgdDogdCxcbiAgICAgICAgc2VsZWN0ZWQ6IHQgPT09IHRfc2VsZWN0XG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGRhdGE7XG59XG5cbi8vIEdlbmVyYXRlIGNvbmRpdGlvbmFsIGRpc3RyaWJ1dGlvbiBkYXRhIChYIGdpdmVuIFQgPSB0KVxuY29uZGl0aW9uYWxEYXRhID0ge1xuICBjb25zdCBkYXRhID0gW107XG5cbiAgLy8gT25seSBwcm9jZXNzIGlmIHRfc2VsZWN0IGlzIHZhbGlkXG4gIGlmICh0X3NlbGVjdCA8PSAyICogbikge1xuICAgIC8vIEZpbmQgYWxsICh4MSwgeDIpIHBhaXJzIHdoZXJlIHgxICsgeDIgPSB0XG4gICAgY29uc3QgdmFsaWRQYWlycyA9IGpvaW50RGF0YS5maWx0ZXIoZCA9PiBkLnQgPT09IHRfc2VsZWN0KTtcbiAgICBjb25zdCB0b3RhbENvbmRQcm9iID0gdmFsaWRQYWlycy5yZWR1Y2UoKHN1bSwgZCkgPT4gc3VtICsgZC5wcm9iLCAwKTtcbiAgICBcbiAgICB2YWxpZFBhaXJzLmZvckVhY2goZCA9PiB7XG4gICAgICBpZiAodG90YWxDb25kUHJvYiA+IDApIHtcbiAgICAgICAgZGF0YS5wdXNoKHtcbiAgICAgICAgICB4MTogZC54MSxcbiAgICAgICAgICB4MjogZC54MixcbiAgICAgICAgICBjb25kUHJvYjogZC5wcm9iIC8gdG90YWxDb25kUHJvYixcbiAgICAgICAgICB0OiBkLnRcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbiAgXG4gIHJldHVybiBkYXRhO1xufVxuXG4vLyBDYWxjdWxhdGUgbWF4aW11bSBwcm9iYWJpbGl0eSBmb3Igc2NhbGluZ1xubWF4UHJvYiA9IE1hdGgubWF4KC4uLmpvaW50RGF0YS5tYXAoZCA9PiBkLnByb2IpKVxubWF4Q29uZFByb2IgPSBjb25kaXRpb25hbERhdGEubGVuZ3RoID4gMCA/IE1hdGgubWF4KC4uLmNvbmRpdGlvbmFsRGF0YS5tYXAoZCA9PiBkLmNvbmRQcm9iKSkgOiAxXG5cbi8vIEdlbmVyYXRlIG1hcmdpbmFsIGRpc3RyaWJ1dGlvbnNcbm1hcmdpbmFsWDEgPSB7XG4gIGNvbnN0IGRhdGEgPSBbXTtcbiAgZm9yIChsZXQgeDEgPSAwOyB4MSA8PSBuOyB4MSsrKSB7XG4gICAgZGF0YS5wdXNoKHtcbiAgICAgIHgxOiB4MSxcbiAgICAgIHByb2I6IHBtZih4MSwgbiwgdGhldGEpXG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIGRhdGE7XG59XG5cbm1hcmdpbmFsWDIgPSB7XG4gIGNvbnN0IGRhdGEgPSBbXTtcbiAgZm9yIChsZXQgeDIgPSAwOyB4MiA8PSBuOyB4MisrKSB7XG4gICAgZGF0YS5wdXNoKHtcbiAgICAgIHgyOiB4MixcbiAgICAgIHByb2I6IHBtZih4MiwgbiwgdGhldGEpXG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIGRhdGE7XG59XG5cbi8vIEdlbmVyYXRlIGNvbmRpdGlvbmFsIG1hcmdpbmFsIGRpc3RyaWJ1dGlvbnNcbmNvbmRpdGlvbmFsTWFyZ2luYWxYMSA9IHtcbiAgY29uc3QgZGF0YSA9IFtdO1xuICBjb25zdCB0b3RhbFQgPSBNYXRoLm1pbih0X3NlbGVjdCwgMiAqIG4pO1xuICBcbiAgLy8gT25seSBwcm9jZXNzIGlmIHRfc2VsZWN0IGlzIHZhbGlkXG4gIGlmICh0X3NlbGVjdCA8PSAyICogbikge1xuICAgIC8vIENhbGN1bGF0ZSB0b3RhbCBwcm9iYWJpbGl0eSBmb3Igbm9ybWFsaXphdGlvblxuICAgIGxldCB0b3RhbFByb2IgPSAwO1xuICAgIGZvciAobGV0IHgxID0gTWF0aC5tYXgoMCwgdG90YWxUIC0gbik7IHgxIDw9IE1hdGgubWluKG4sIHRvdGFsVCk7IHgxKyspIHtcbiAgICAgIGNvbnN0IHgyID0gdG90YWxUIC0geDE7XG4gICAgICBpZiAoeDIgPj0gMCAmJiB4MiA8PSBuKSB7XG4gICAgICAgIHRvdGFsUHJvYiArPSBwbWYoeDEsIG4sIHRoZXRhKSAqIHBtZih4MiwgbiwgdGhldGEpO1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICBmb3IgKGxldCB4MSA9IDA7IHgxIDw9IG47IHgxKyspIHtcbiAgICAgIGNvbnN0IHgyID0gdG90YWxUIC0geDE7XG4gICAgICBpZiAoeDIgPj0gMCAmJiB4MiA8PSBuICYmIHRvdGFsUHJvYiA+IDApIHtcbiAgICAgICAgY29uc3Qgam9pbnRQcm9iID0gcG1mKHgxLCBuLCB0aGV0YSkgKiBwbWYoeDIsIG4sIHRoZXRhKTtcbiAgICAgICAgZGF0YS5wdXNoKHtcbiAgICAgICAgICB4MTogeDEsXG4gICAgICAgICAgcHJvYjogam9pbnRQcm9iIC8gdG90YWxQcm9iXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gZGF0YTtcbn1cblxuY29uZGl0aW9uYWxNYXJnaW5hbFgyID0ge1xuICBjb25zdCBkYXRhID0gW107XG4gIGNvbnN0IHRvdGFsVCA9IE1hdGgubWluKHRfc2VsZWN0LCAyICogbik7XG4gIFxuICAvLyBPbmx5IHByb2Nlc3MgaWYgdF9zZWxlY3QgaXMgdmFsaWQgIFxuICBpZiAodF9zZWxlY3QgPD0gMiAqIG4pIHtcbiAgICAvLyBDYWxjdWxhdGUgdG90YWwgcHJvYmFiaWxpdHkgZm9yIG5vcm1hbGl6YXRpb25cbiAgICBsZXQgdG90YWxQcm9iID0gMDtcbiAgICBmb3IgKGxldCB4MiA9IE1hdGgubWF4KDAsIHRvdGFsVCAtIG4pOyB4MiA8PSBNYXRoLm1pbihuLCB0b3RhbFQpOyB4MisrKSB7XG4gICAgICBjb25zdCB4MSA9IHRvdGFsVCAtIHgyO1xuICAgICAgaWYgKHgxID49IDAgJiYgeDEgPD0gbikge1xuICAgICAgICB0b3RhbFByb2IgKz0gcG1mKHgxLCBuLCB0aGV0YSkgKiBwbWYoeDIsIG4sIHRoZXRhKTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgZm9yIChsZXQgeDIgPSAwOyB4MiA8PSBuOyB4MisrKSB7XG4gICAgICBjb25zdCB4MSA9IHRvdGFsVCAtIHgyO1xuICAgICAgaWYgKHgxID49IDAgJiYgeDEgPD0gbiAmJiB0b3RhbFByb2IgPiAwKSB7XG4gICAgICAgIGNvbnN0IGpvaW50UHJvYiA9IHBtZih4MSwgbiwgdGhldGEpICogcG1mKHgyLCBuLCB0aGV0YSk7XG4gICAgICAgIGRhdGEucHVzaCh7XG4gICAgICAgICAgeDI6IHgyLFxuICAgICAgICAgIHByb2I6IGpvaW50UHJvYiAvIHRvdGFsUHJvYlxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIGRhdGE7XG59XG5cbm1heFJhZCA9IDE1ICogNSAvIChuICsgMSlcblxubWF4TWFyZ2luYWxQcm9iID0gTWF0aC5tYXgoLi4ubWFyZ2luYWxYMS5tYXAoZCA9PiBkLnByb2IpLCAuLi5tYXJnaW5hbFgyLm1hcChkID0+IGQucHJvYikpXG5tYXhDb25kTWFyZ2luYWxQcm9iID0gY29uZGl0aW9uYWxNYXJnaW5hbFgxLmxlbmd0aCA+IDAgJiYgY29uZGl0aW9uYWxNYXJnaW5hbFgyLmxlbmd0aCA+IDAgPyBcbiAgTWF0aC5tYXgoLi4uY29uZGl0aW9uYWxNYXJnaW5hbFgxLm1hcChkID0+IGQucHJvYiksIC4uLmNvbmRpdGlvbmFsTWFyZ2luYWxYMi5tYXAoZCA9PiBkLnByb2IpKSA6IDFcblxuLy8gQ3JlYXRlIGpvaW50IGRpc3RyaWJ1dGlvbiBwbG90IHdpdGggbWFyZ2luYWwgaGlzdG9ncmFtc1xuam9pbnRQbG90ID0gUGxvdC5wbG90KHtcbiAgd2lkdGg6IDQ4MCxcbiAgaGVpZ2h0OiA0ODAsXG4gIG1hcmdpblRvcDogMTQwLFxuICBtYXJnaW5MZWZ0OiA4MCxcbiAgbWFyZ2luQm90dG9tOiA4MCxcbiAgbWFyZ2luUmlnaHQ6IDEyMCxcbiAgc3R5bGU6IHsgZm9udFNpemU6IFwiMTZweFwiIH0sXG4gIFxuICByOiB7XG4gICAgdHlwZTogXCJsaW5lYXJcIixcbiAgICBkb21haW46IFswLCBtYXhSYWRdLCAgLy8gRml4ZWQgZG9tYWluIGZyb20gMCB0byBtYXhSYWRcbiAgICByYW5nZTogWzAsIG1heFJhZF0sICAgLy8gTWFwcyBkaXJlY3RseSB0byBwaXhlbCBzaXplc1xuICAgIGNsYW1wOiBmYWxzZSAgICAgICAvLyBQcmV2ZW50cyB2YWx1ZXMgb3V0c2lkZSBkb21haW5cbiAgfSxcblxuICBcbiAgeDoge1xuICAgIGRvbWFpbjogWy0wLjUsIG4gKyAwLjVdLFxuICAgIHRpY2tzOiBBcnJheS5mcm9tKHtsZW5ndGg6IG4gKyAxfSwgKF8sIGkpID0+IGkpLFxuICAgIHRpY2tGb3JtYXQ6IGQgPT4gZC50b1N0cmluZygpLFxuICAgIGxhYmVsOiBcIljigoFcIixcbiAgICBsYWJlbEFuY2hvcjogXCJjZW50ZXJcIixcbiAgICBsYWJlbE9mZnNldDogNTBcbiAgfSxcbiAgeToge1xuICAgIGRvbWFpbjogWy0wLjUsIG4gKyAwLjVdLFxuICAgIHRpY2tzOiBBcnJheS5mcm9tKHtsZW5ndGg6IG4gKyAxfSwgKF8sIGkpID0+IGkpLFxuICAgIHRpY2tGb3JtYXQ6IGQgPT4gZC50b1N0cmluZygpLFxuICAgIGxhYmVsOiBcIljigoJcIixcbiAgICBsYWJlbEFuY2hvcjogXCJjZW50ZXJcIixcbiAgICBsYWJlbE9mZnNldDogNTBcbiAgfSxcbiAgXG4gIG1hcmtzOiBbXG4gICAgLy8gR3JpZCBsaW5lc1xuICAgIFBsb3QucnVsZVgoQXJyYXkuZnJvbSh7bGVuZ3RoOiBuICsgMX0sIChfLCBpKSA9PiBpKSwge3N0cm9rZTogXCIjZjBmMGYwXCJ9KSxcbiAgICBQbG90LnJ1bGVZKEFycmF5LmZyb20oe2xlbmd0aDogbiArIDF9LCAoXywgaSkgPT4gaSksIHtzdHJva2U6IFwiI2YwZjBmMFwifSksXG4gICAgXG4gICAgLy8gUHJvYmFiaWxpdHkgY2lyY2xlc1xuICAgIFBsb3QuZG90KGpvaW50RGF0YSwge1xuICAgICAgeDogXCJ4MVwiLCBcbiAgICAgIHk6IFwieDJcIiwgXG4gICAgICByOiBkID0+IE1hdGguc3FydChkLnByb2IgLyBtYXhQcm9iKSAqIG1heFJhZCwgICBcbiAgICAgIGZpbGw6IGQgPT4gZC5zZWxlY3RlZCA/IFwicmVkXCIgOiBcInN0ZWVsYmx1ZVwiLFxuICAgICAgZmlsbE9wYWNpdHk6IDAuNyxcbiAgICAgIHN0cm9rZTogXCJibGFja1wiLFxuICAgICAgc3Ryb2tlV2lkdGg6IDAuNVxuICAgIH0pLFxuICAgIFxuICAgIC8vIFRvcCBtYXJnaW5hbCBoaXN0b2dyYW0gKFjigoEpXG4gICAgUGxvdC5yZWN0KG1hcmdpbmFsWDEsIHtcbiAgICAgIHgxOiBkID0+IGQueDEgLSAwLjMsXG4gICAgICB4MjogZCA9PiBkLngxICsgMC4zLFxuICAgICAgeTE6IG4gKyAwLjU2ICsgbiAqIC4wNixcbiAgICAgIHkyOiBkID0+IG4gKyAwLjU2ICsgbiAqIC4wNiArIChkLnByb2IgLyBtYXhNYXJnaW5hbFByb2IpICogKG4gKyAxKSAqIDAuMyxcbiAgICAgIGZpbGw6IFwic3RlZWxibHVlXCIsXG4gICAgICBmaWxsT3BhY2l0eTogMC43LFxuICAgICAgc3Ryb2tlOiBcImJsYWNrXCIsXG4gICAgICBzdHJva2VXaWR0aDogMC41XG4gICAgfSksXG4gICAgXG4gICAgLy8gUmlnaHQgbWFyZ2luYWwgaGlzdG9ncmFtIChY4oKCKVxuICAgIFBsb3QucmVjdChtYXJnaW5hbFgyLCB7XG4gICAgICB4MTogbiArIDAuNTYgKyBuICogLjA2LFxuICAgICAgeDI6IGQgPT4gbiArIDAuNTYgKyBuICogLjA2ICsgKGQucHJvYiAvIG1heE1hcmdpbmFsUHJvYikgKiAobiArIDEpICogMC4zLFxuICAgICAgeTE6IGQgPT4gZC54MiAtIDAuMyxcbiAgICAgIHkyOiBkID0+IGQueDIgKyAwLjMsXG4gICAgICBmaWxsOiBcInN0ZWVsYmx1ZVwiLFxuICAgICAgZmlsbE9wYWNpdHk6IDAuNyxcbiAgICAgIHN0cm9rZTogXCJibGFja1wiLFxuICAgICAgc3Ryb2tlV2lkdGg6IDAuNVxuICAgIH0pLFxuICAgIFxuICAgIC8vIFRpdGxlXG4gICAgUGxvdC50ZXh0KFtcIkpvaW50IERpc3RyaWJ1dGlvbiBvZiBYID0gKFjigoEsIFjigoIpXCJdLCB7XG4gICAgICB4OiBuLzIsIFxuICAgICAgeTogbiArIDAuNSArIChuICsgMSkgKiAuNDUsIFxuICAgICAgZm9udFNpemU6IDI0LCBcbiAgICAgIGZvbnRXZWlnaHQ6IFwiYm9sZFwiLFxuICAgICAgdGV4dEFuY2hvcjogXCJtaWRkbGVcIlxuICAgIH0pXG4gIF1cbn0pXG5cbi8vIENyZWF0ZSBjb25kaXRpb25hbCBkaXN0cmlidXRpb24gcGxvdCB3aXRoIGNvbmRpdGlvbmFsIG1hcmdpbmFsIGhpc3RvZ3JhbXNcbmNvbmRpdGlvbmFsUGxvdCA9IFBsb3QucGxvdCh7XG4gIHdpZHRoOiA0ODAsXG4gIGhlaWdodDogNDgwLFxuICBtYXJnaW5Ub3A6IDE0MCxcbiAgbWFyZ2luTGVmdDogODAsXG4gIG1hcmdpbkJvdHRvbTogODAsXG4gIG1hcmdpblJpZ2h0OiAxMjAsXG4gIHN0eWxlOiB7IGZvbnRTaXplOiBcIjE2cHhcIiB9LFxuICBcbiAgcjoge1xuICAgIHR5cGU6IFwibGluZWFyXCIsXG4gICAgZG9tYWluOiBbMCwgbWF4UmFkXSwgIC8vIEZpeGVkIGRvbWFpbiBmcm9tIDAgdG8gMjBcbiAgICByYW5nZTogWzAsIG1heFJhZF0sICAgLy8gTWFwcyBkaXJlY3RseSB0byBwaXhlbCAgIHNpemVzICBcbiAgICBjbGFtcDogZmFsc2UgICAgICAgLy8gUHJldmVudHMgdmFsdWVzIG91dHNpZGUgZG9tYWluXG4gIH0sXG4gIHg6IHtcbiAgICBkb21haW46IFstMC41LCBuICsgMC41XSxcbiAgICB0aWNrczogQXJyYXkuZnJvbSh7bGVuZ3RoOiBuICsgMX0sIChfLCBpKSA9PiBpKSxcbiAgICB0aWNrRm9ybWF0OiBkID0+IGQudG9TdHJpbmcoKSxcbiAgICBsYWJlbDogXCJY4oKBXCIsXG4gICAgbGFiZWxBbmNob3I6IFwiY2VudGVyXCIsXG4gICAgbGFiZWxPZmZzZXQ6IDUwXG4gIH0sXG4gIHk6IHtcbiAgICBkb21haW46IFstMC41LCBuICsgMC41XSxcbiAgICB0aWNrczogQXJyYXkuZnJvbSh7bGVuZ3RoOiBuICsgMX0sIChfLCBpKSA9PiBpKSxcbiAgICB0aWNrRm9ybWF0OiBkID0+IGQudG9TdHJpbmcoKSxcbiAgICBsYWJlbDogXCJY4oKCXCIsXG4gICAgbGFiZWxBbmNob3I6IFwiY2VudGVyXCIsXG4gICAgbGFiZWxPZmZzZXQ6IDUwXG4gIH0sXG4gIFxuICBtYXJrczogW1xuICAgIC8vIEdyaWQgbGluZXNcbiAgICBQbG90LnJ1bGVYKEFycmF5LmZyb20oe2xlbmd0aDogbiArIDF9LCAoXywgaSkgPT4gaSksIHtzdHJva2U6IFwiI2YwZjBmMFwifSksXG4gICAgUGxvdC5ydWxlWShBcnJheS5mcm9tKHtsZW5ndGg6IG4gKyAxfSwgKF8sIGkpID0+IGkpLCB7c3Ryb2tlOiBcIiNmMGYwZjBcIn0pLFxuICAgIFxuICAgIC8vIEFsbCBwb3NzaWJsZSBwb2ludHMgKGZhZGVkKVxuICAgIFBsb3QuZG90KGpvaW50RGF0YSwge1xuICAgICAgeDogXCJ4MVwiLCBcbiAgICAgIHk6IFwieDJcIiwgXG4gICAgICByOiAzLFxuICAgICAgZmlsbDogXCJsaWdodGdyYXlcIixcbiAgICAgIGZpbGxPcGFjaXR5OiAwLjNcbiAgICB9KSxcbiAgICBcbiAgICAvLyBDb25kaXRpb25hbCBwcm9iYWJpbGl0eSBjaXJjbGVzXG4gICAgUGxvdC5kb3QoY29uZGl0aW9uYWxEYXRhLCB7XG4gICAgICB4OiBcIngxXCIsIFxuICAgICAgeTogXCJ4MlwiLCBcbiAgICAgIHI6IGQgPT4gY29uZGl0aW9uYWxEYXRhLmxlbmd0aCA+IDAgPyBNYXRoLnNxcnQoZC5jb25kUHJvYiAvIG1heENvbmRQcm9iKSAqIG1heFJhZCA6IDUsXG4gICAgICBmaWxsOiBcInJlZFwiLFxuICAgICAgZmlsbE9wYWNpdHk6IDAuOCxcbiAgICAgIHN0cm9rZTogXCJibGFja1wiLFxuICAgICAgc3Ryb2tlV2lkdGg6IDFcbiAgICB9KSxcbiAgICBcbiAgICAvLyBUb3AgY29uZGl0aW9uYWwgbWFyZ2luYWwgaGlzdG9ncmFtIChY4oKBIHwgVCA9IHQpXG4gICAgUGxvdC5yZWN0KGNvbmRpdGlvbmFsTWFyZ2luYWxYMSwge1xuICAgICAgeDE6IGQgPT4gZC54MSAtIDAuMyxcbiAgICAgIHgyOiBkID0+IGQueDEgKyAwLjMsXG4gICAgICB5MTogbiArIDAuNTYgKyBuICogLjA2LFxuICAgICAgeTI6IGQgPT4gbiArIDAuNTYgKyBuICogLjA2ICsgKGQucHJvYiAvIG1heENvbmRNYXJnaW5hbFByb2IpICogKG4gKyAxKSAqIDAuMyxcbiAgICAgIGZpbGw6IFwicmVkXCIsXG4gICAgICBmaWxsT3BhY2l0eTogMC43LFxuICAgICAgc3Ryb2tlOiBcImJsYWNrXCIsXG4gICAgICBzdHJva2VXaWR0aDogMC41XG4gICAgfSksXG4gICAgXG4gICAgLy8gUmlnaHQgY29uZGl0aW9uYWwgbWFyZ2luYWwgaGlzdG9ncmFtIChY4oKCIHwgVCA9IHQpXG4gICAgUGxvdC5yZWN0KGNvbmRpdGlvbmFsTWFyZ2luYWxYMiwge1xuICAgICAgeDE6IG4gKyAwLjU2ICsgbiAqIC4wNixcbiAgICAgIHgyOiBkID0+IG4gKyAwLjU2ICsgbiAqIC4wNiArIChkLnByb2IgLyBtYXhDb25kTWFyZ2luYWxQcm9iKSAqIChuICsgMSkgKiAwLjMsXG4gICAgICB5MTogZCA9PiBkLngyIC0gMC4zLFxuICAgICAgeTI6IGQgPT4gZC54MiArIDAuMyxcbiAgICAgIGZpbGw6IFwicmVkXCIsXG4gICAgICBmaWxsT3BhY2l0eTogMC43LFxuICAgICAgc3Ryb2tlOiBcImJsYWNrXCIsXG4gICAgICBzdHJva2VXaWR0aDogMC41XG4gICAgfSksXG4gICAgXG4gICAgLy8gVGl0bGVcbiAgICBQbG90LnRleHQoW2BDb25kaXRpb25hbCBEaXN0cmlidXRpb24gUChYIHwgVCA9ICR7dF9zZWxlY3R9KWBdLCB7XG4gICAgICB4OiBuLzIsIFxuICAgICAgeTogbiArIDAuNSArIChuICsgMSkgKiAuNDUsIFxuICAgICAgZm9udFNpemU6IDI0LCBcbiAgICAgIGZvbnRXZWlnaHQ6IFwiYm9sZFwiLFxuICAgICAgdGV4dEFuY2hvcjogXCJtaWRkbGVcIlxuICAgIH0pXG4gIF1cbn0pXG5cbi8vIERpc3BsYXkgcGxvdHMgc2lkZSBieSBzaWRlXG5odG1sYDxkaXYgc3R5bGU9XCJkaXNwbGF5OiBmbGV4OyBnYXA6IDIwcHg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGp1c3RpZnktY29udGVudDogY2VudGVyO1wiPlxuICAke2pvaW50UGxvdH1cbiAgJHtjb25kaXRpb25hbFBsb3R9XG48L2Rpdj5gXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJcbi8vIEludGVyYWN0aXZlIGNvbnRyb2xzXG52aWV3b2YgbjIgPSBJbnB1dHMucmFuZ2UoWzEsIDhdLCB7dmFsdWU6IDQsIHN0ZXA6IDEsIGxhYmVsOiBcIm5cIn0pXG52aWV3b2YgdGhldGEyID0gSW5wdXRzLnJhbmdlKFswLjAxLCAwLjk5XSwge3ZhbHVlOiAwLjMwLCBzdGVwOiAwLjAxLCBsYWJlbDogXCLOuFwifSlcbi8vIE1ldGhvZCAzOiBVc2luZyBhIHNpbmdsZSBjb21iaW5lZCBpbnB1dFxudmlld29mIFMgPSB7XG4gIGNvbnN0IGZvcm0gPSBodG1sYDxmb3JtIHN0eWxlPVwiZm9udDogMTNweCB2YXIoLS1zYW5zLXNlcmlmKTsgZGlzcGxheTogZmxleDsgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsgZ2FwOiA4cHg7XCI+XG4gICAgPGRpdiBzdHlsZT1cImRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7XCI+XG4gICAgICA8bGFiZWwgc3R5bGU9XCJkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBnYXA6IDAuNWVtOyBtaW4td2lkdGg6IDE4MHB4O1wiPlxuICAgICAgICA8c3BhbiBzdHlsZT1cIndpZHRoOiA4ZW07XCI+U+KCgSA9IHPigoE8L3NwYW4+XG4gICAgICAgIDxpbnB1dCBpZD1cInMxLXRleHRcIiB0eXBlPVwibnVtYmVyXCIgbWluPVwiMFwiIG1heD1cIiR7bjJ9XCIgc3RlcD1cIjFcIiB2YWx1ZT1cIjFcIiBcbiAgICAgICAgICAgICAgIHN0eWxlPVwid2lkdGg6IDVlbTsgZm9udDogaW5oZXJpdDtcIj5cbiAgICAgICAgPGlucHV0IG5hbWU9XCJzMVwiIHR5cGU9XCJyYW5nZVwiIG1pbj1cIjBcIiBtYXg9XCIke24yfVwiIHN0ZXA9XCIxXCIgdmFsdWU9XCIxXCIgXG4gICAgICAgICAgICAgICBzdHlsZT1cImZsZXg6IDE7IG1hcmdpbi1sZWZ0OiAwLjVlbTtcIj5cbiAgICAgIDwvbGFiZWw+XG4gICAgPC9kaXY+XG4gICAgPGRpdiBzdHlsZT1cImRpc3BsYXk6IGZsZXg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7XCI+XG4gICAgICA8bGFiZWwgc3R5bGU9XCJkaXNwbGF5OiBmbGV4OyBhbGlnbi1pdGVtczogY2VudGVyOyBnYXA6IDAuNWVtOyBtaW4td2lkdGg6IDE4MHB4O1wiPlxuICAgICAgICA8c3BhbiBzdHlsZT1cIndpZHRoOiA4ZW07XCI+U+KCgiA9IHPigoI8L3NwYW4+XG4gICAgICAgIDxpbnB1dCBpZD1cInMyLXRleHRcIiB0eXBlPVwibnVtYmVyXCIgbWluPVwiMFwiIG1heD1cIiR7bjJ9XCIgc3RlcD1cIjFcIiB2YWx1ZT1cIjNcIiBcbiAgICAgICAgICAgICAgIHN0eWxlPVwid2lkdGg6IDVlbTsgZm9udDogaW5oZXJpdDtcIj5cbiAgICAgICAgPGlucHV0IG5hbWU9XCJzMlwiIHR5cGU9XCJyYW5nZVwiIG1pbj1cIjBcIiBtYXg9XCIke24yfVwiIHN0ZXA9XCIxXCIgdmFsdWU9XCIzXCIgXG4gICAgICAgICAgICAgICBzdHlsZT1cImZsZXg6IDE7IG1hcmdpbi1sZWZ0OiAwLjVlbTtcIj5cbiAgICAgIDwvbGFiZWw+XG4gICAgPC9kaXY+XG4gIDwvZm9ybT5gO1xuICBcbiAgY29uc3QgczFJbnB1dCA9IGZvcm0ucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT1cInMxXCJdJyk7XG4gIGNvbnN0IHMySW5wdXQgPSBmb3JtLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9XCJzMlwiXScpO1xuICBjb25zdCBzMVRleHRJbnB1dCA9IGZvcm0ucXVlcnlTZWxlY3RvcignI3MxLXRleHQnKTtcbiAgY29uc3QgczJUZXh0SW5wdXQgPSBmb3JtLnF1ZXJ5U2VsZWN0b3IoJyNzMi10ZXh0Jyk7XG4gIFxuICBmdW5jdGlvbiB1cGRhdGVDb25zdHJhaW50cyhjaGFuZ2VkSW5wdXQpIHtcbiAgICBjb25zdCBzMVZhbCA9IHBhcnNlRmxvYXQoczFJbnB1dC52YWx1ZSk7XG4gICAgY29uc3QgczJWYWwgPSBwYXJzZUZsb2F0KHMySW5wdXQudmFsdWUpO1xuICAgIFxuICAgIC8vIEVuZm9yY2UgczEgPD0gczIgYnkgYWRqdXN0aW5nIHRoZSBpbnB1dCB0aGF0IHdhc24ndCBjaGFuZ2VkXG4gICAgaWYgKHMxVmFsID4gczJWYWwpIHtcbiAgICAgIGlmIChjaGFuZ2VkSW5wdXQgPT09ICdzMScpIHtcbiAgICAgICAgLy8gczEgd2FzIGNoYW5nZWQgYW5kIHdlbnQgYWJvdmUgczIsIHNvIGFkanVzdCBzMiB1cFxuICAgICAgICBzMklucHV0LnZhbHVlID0gczFWYWw7XG4gICAgICAgIHMyVGV4dElucHV0LnZhbHVlID0gczFWYWw7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBzMiB3YXMgY2hhbmdlZCBhbmQgd2VudCBiZWxvdyBzMSwgc28gYWRqdXN0IHMxIGRvd25cbiAgICAgICAgczFJbnB1dC52YWx1ZSA9IHMyVmFsO1xuICAgICAgICBzMVRleHRJbnB1dC52YWx1ZSA9IHMyVmFsO1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBVcGRhdGUgdGV4dCBkaXNwbGF5cyB0byBtYXRjaCBzbGlkZXJzXG4gICAgczFUZXh0SW5wdXQudmFsdWUgPSBzMUlucHV0LnZhbHVlO1xuICAgIHMyVGV4dElucHV0LnZhbHVlID0gczJJbnB1dC52YWx1ZTtcbiAgICBcbiAgICAvLyBVcGRhdGUgdGhlIGZvcm0ncyB2YWx1ZSBwcm9wZXJ0eSBmb3IgT2JzZXJ2YWJsZVxuICAgIGZvcm0udmFsdWUgPSB7XG4gICAgICBzMTogcGFyc2VGbG9hdChzMUlucHV0LnZhbHVlKSxcbiAgICAgIHMyOiBwYXJzZUZsb2F0KHMySW5wdXQudmFsdWUpXG4gICAgfTtcbiAgICBcbiAgICAvLyBEaXNwYXRjaCBpbnB1dCBldmVudFxuICAgIGZvcm0uZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoXCJpbnB1dFwiKSk7XG4gIH1cbiAgXG4gIGZ1bmN0aW9uIHVwZGF0ZUZyb21UZXh0KGNoYW5nZWRJbnB1dCkge1xuICAgIC8vIFVwZGF0ZSBzbGlkZXIgZnJvbSB0ZXh0IGlucHV0XG4gICAgaWYgKGNoYW5nZWRJbnB1dCA9PT0gJ3MxJykge1xuICAgICAgczFJbnB1dC52YWx1ZSA9IHMxVGV4dElucHV0LnZhbHVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBzMklucHV0LnZhbHVlID0gczJUZXh0SW5wdXQudmFsdWU7XG4gICAgfVxuICAgIC8vIFRoZW4gYXBwbHkgY29uc3RyYWludHNcbiAgICB1cGRhdGVDb25zdHJhaW50cyhjaGFuZ2VkSW5wdXQpO1xuICB9XG4gIFxuICAvLyBMaXN0ZW4gdG8gc2xpZGVyIGNoYW5nZXNcbiAgczFJbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4gdXBkYXRlQ29uc3RyYWludHMoJ3MxJykpO1xuICBzMklucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB1cGRhdGVDb25zdHJhaW50cygnczInKSk7XG4gIFxuICAvLyBMaXN0ZW4gdG8gdGV4dCBpbnB1dCBjaGFuZ2VzXG4gIHMxVGV4dElucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB1cGRhdGVGcm9tVGV4dCgnczEnKSk7XG4gIHMyVGV4dElucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB1cGRhdGVGcm9tVGV4dCgnczInKSk7XG4gIFxuICB1cGRhdGVDb25zdHJhaW50cygnczEnKTsgLy8gSW5pdGlhbGl6ZVxuICBcbiAgcmV0dXJuIGZvcm07XG59XG5cbi8vIEV4dHJhY3QgeCBhbmQgeSBmcm9tIHJhbmdlXG5zMV9zZWxlY3QgPSBTLnMxXG5zMl9zZWxlY3QgPSBTLnMyXG52aWV3b2YgZGlzdHJpYnV0aW9uVHlwZTIgPSBJbnB1dHMucmFkaW8oW1wiQmlub21pYWxcIiwgXCJEaXNjcmV0ZSBMYXBsYWNlXCJdLCB7dmFsdWU6IFwiQmlub21pYWxcIiwgbGFiZWw6IFwiRGlzdHJpYnV0aW9uXCJ9KVxuXG4vLyBTZWxlY3Qgd2hpY2ggUE1GIHRvIHVzZSBiYXNlZCBvbiBkcm9wZG93biBzZWxlY3Rpb25cbnBtZjIgPSBkaXN0cmlidXRpb25UeXBlMiA9PT0gXCJCaW5vbWlhbFwiID8gYmlub21QTUYgOiBleHBQTUZcblxuLy8gR2VuZXJhdGUgam9pbnQgZGlzdHJpYnV0aW9uIGRhdGFcbmpvaW50RGF0YTIgPSB7XG4gIGNvbnN0IGRhdGEgPSBbXTtcbiAgZm9yIChsZXQgeDEgPSAwOyB4MSA8PSBuMjsgeDErKykge1xuICAgIGZvciAobGV0IHgyID0gMDsgeDIgPD0gbjI7IHgyKyspIHtcbiAgICAgIGNvbnN0IHByb2IgPSBwbWYoeDEsIG4yLCB0aGV0YTIpICogcG1mKHgyLCBuMiwgdGhldGEyKTtcbiAgICAgIGNvbnN0IHhfbWluID0gTWF0aC5taW4oeDEsIHgyKTtcbiAgICAgIGNvbnN0IHhfbWF4ID0gTWF0aC5tYXgoeDEsIHgyKTtcbiAgICAgIGRhdGEucHVzaCh7XG4gICAgICAgIHgxOiB4MSxcbiAgICAgICAgeDI6IHgyLFxuICAgICAgICBwcm9iOiBwcm9iLFxuICAgICAgICB4X21pbjogeF9taW4sXG4gICAgICAgIHhfbWF4OiB4X21heCxcbiAgICAgICAgc2VsZWN0ZWQ6IHhfbWluID09PSBzMV9zZWxlY3QgJiYgeF9tYXggPT09IHMyX3NlbGVjdFxuICAgICAgfSk7XG4gICAgfVxuICB9XG4gIHJldHVybiBkYXRhO1xufVxuXG4vLyBHZW5lcmF0ZSBjb25kaXRpb25hbCBkaXN0cmlidXRpb24gZGF0YSAoWCBnaXZlbiBUID0gdClcbmNvbmRpdGlvbmFsRGF0YTIgPSB7XG4gIGNvbnN0IGRhdGEgPSBbXTtcbiAgY29uc3QgdmFsaWRQYWlycyA9IGpvaW50RGF0YTIuZmlsdGVyKGQgPT4gZC54X21pbiA9PT0gczFfc2VsZWN0ICYmIGQueF9tYXggPT09IHMyX3NlbGVjdCk7XG4gIGNvbnN0IHRvdGFsQ29uZFByb2IgPSB2YWxpZFBhaXJzLnJlZHVjZSgoc3VtLCBkKSA9PiBzdW0gKyBkLnByb2IsIDApO1xuICAgIFxuICB2YWxpZFBhaXJzLmZvckVhY2goZCA9PiB7XG4gICAgaWYgKHRvdGFsQ29uZFByb2IgPiAwKSB7XG4gICAgICBkYXRhLnB1c2goe1xuICAgICAgICB4MTogZC54MSxcbiAgICAgICAgeDI6IGQueDIsXG4gICAgICAgIGNvbmRQcm9iOiBkLnByb2IgLyB0b3RhbENvbmRQcm9iLFxuICAgICAgICB4X21pbjogZC54X21pbixcbiAgICAgICAgeF9tYXg6IGQueF9tYXhcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuIGRhdGE7XG59XG5cbi8vIENhbGN1bGF0ZSBtYXhpbXVtIHByb2JhYmlsaXR5IGZvciBzY2FsaW5nXG5tYXhQcm9iMiA9IE1hdGgubWF4KC4uLmpvaW50RGF0YTIubWFwKGQgPT4gZC5wcm9iKSlcbm1heENvbmRQcm9iMiA9IGNvbmRpdGlvbmFsRGF0YTIubGVuZ3RoID4gMCA/IE1hdGgubWF4KC4uLmNvbmRpdGlvbmFsRGF0YTIubWFwKGQgPT4gZC5jb25kUHJvYikpIDogMVxuXG4vLyBHZW5lcmF0ZSBtYXJnaW5hbCBkaXN0cmlidXRpb25zXG5tYXJnaW5hbFgxMiA9IHtcbiAgY29uc3QgZGF0YSA9IFtdO1xuICBmb3IgKGxldCB4MSA9IDA7IHgxIDw9IG4yOyB4MSsrKSB7XG4gICAgZGF0YS5wdXNoKHtcbiAgICAgIHgxOiB4MSxcbiAgICAgIHByb2I6IHBtZih4MSwgbjIsIHRoZXRhMilcbiAgICB9KTtcbiAgfVxuICByZXR1cm4gZGF0YTtcbn1cblxubWFyZ2luYWxYMjIgPSB7XG4gIGNvbnN0IGRhdGEgPSBbXTtcbiAgZm9yIChsZXQgeDIgPSAwOyB4MiA8PSBuMjsgeDIrKykge1xuICAgIGRhdGEucHVzaCh7XG4gICAgICB4MjogeDIsXG4gICAgICBwcm9iOiBwbWYoeDIsIG4yLCB0aGV0YTIpXG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIGRhdGE7XG59XG5cbi8vIEdlbmVyYXRlIGNvbmRpdGlvbmFsIG1hcmdpbmFsIGRpc3RyaWJ1dGlvbnNcbmNvbmRpdGlvbmFsTWFyZ2luYWxYMTIgPSB7XG4gIGNvbnN0IGRhdGEgPSBbXTtcbiAgXG4gIGlmIChjb25kaXRpb25hbERhdGEyLmxlbmd0aCA+IDApIHtcbiAgICAvLyBHcm91cCBieSB4MSBhbmQgc3VtIHByb2JhYmlsaXRpZXNcbiAgICBjb25zdCB4MVByb2JzID0gbmV3IE1hcCgpO1xuICAgIGNvbmRpdGlvbmFsRGF0YTIuZm9yRWFjaChkID0+IHtcbiAgICAgIHgxUHJvYnMuc2V0KGQueDEsICh4MVByb2JzLmdldChkLngxKSB8fCAwKSArIGQuY29uZFByb2IpO1xuICAgIH0pO1xuICAgIFxuICAgIGZvciAobGV0IHgxID0gMDsgeDEgPD0gbjI7IHgxKyspIHtcbiAgICAgIGlmICh4MVByb2JzLmhhcyh4MSkpIHtcbiAgICAgICAgZGF0YS5wdXNoKHtcbiAgICAgICAgICB4MTogeDEsXG4gICAgICAgICAgcHJvYjogeDFQcm9icy5nZXQoeDEpXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBcbiAgcmV0dXJuIGRhdGE7XG59XG5cbmNvbmRpdGlvbmFsTWFyZ2luYWxYMjIgPSB7XG4gIGNvbnN0IGRhdGEgPSBbXTtcbiAgXG4gIGlmIChjb25kaXRpb25hbERhdGEyLmxlbmd0aCA+IDApIHtcbiAgICAvLyBHcm91cCBieSB4MiBhbmQgc3VtIHByb2JhYmlsaXRpZXNcbiAgICBjb25zdCB4MlByb2JzID0gbmV3IE1hcCgpO1xuICAgIGNvbmRpdGlvbmFsRGF0YTIuZm9yRWFjaChkID0+IHtcbiAgICAgIHgyUHJvYnMuc2V0KGQueDIsICh4MlByb2JzLmdldChkLngyKSB8fCAwKSArIGQuY29uZFByb2IpO1xuICAgIH0pO1xuICAgIFxuICAgIGZvciAobGV0IHgyID0gMDsgeDIgPD0gbjI7IHgyKyspIHtcbiAgICAgIGlmICh4MlByb2JzLmhhcyh4MikpIHtcbiAgICAgICAgZGF0YS5wdXNoKHtcbiAgICAgICAgICB4MjogeDIsXG4gICAgICAgICAgcHJvYjogeDJQcm9icy5nZXQoeDIpXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBcbiAgcmV0dXJuIGRhdGE7XG59XG5cbm1heFJhZDIgPSAyMCAqIDUgLyAobjIgKyAxKVxuXG5tYXhNYXJnaW5hbFByb2IyID0gTWF0aC5tYXgoLi4ubWFyZ2luYWxYMTIubWFwKGQgPT4gZC5wcm9iKSwgLi4ubWFyZ2luYWxYMjIubWFwKGQgPT4gZC5wcm9iKSlcbm1heENvbmRNYXJnaW5hbFByb2IyID0gY29uZGl0aW9uYWxNYXJnaW5hbFgxMi5sZW5ndGggPiAwICYmIGNvbmRpdGlvbmFsTWFyZ2luYWxYMjIubGVuZ3RoID4gMCA/IFxuICBNYXRoLm1heCguLi5jb25kaXRpb25hbE1hcmdpbmFsWDEyLm1hcChkID0+IGQucHJvYiksIC4uLmNvbmRpdGlvbmFsTWFyZ2luYWxYMjIubWFwKGQgPT4gZC5wcm9iKSkgOiAxXG5cblxuam9pbnRQbG90MiA9IFBsb3QucGxvdCh7XG4gIHdpZHRoOiA0ODAsXG4gIGhlaWdodDogNDgwLFxuICBtYXJnaW5Ub3A6IDE0MCxcbiAgbWFyZ2luTGVmdDogODAsXG4gIG1hcmdpbkJvdHRvbTogODAsXG4gIG1hcmdpblJpZ2h0OiAxMjAsXG4gIHN0eWxlOiB7IGZvbnRTaXplOiBcIjE2cHhcIiB9LFxuICBcbiAgcjoge1xuICAgIHR5cGU6IFwibGluZWFyXCIsXG4gICAgZG9tYWluOiBbMCwgbWF4UmFkMl0sICAvLyBGaXhlZCBkb21haW4gZnJvbSAwIHRvIDIwXG4gICAgcmFuZ2U6IFswLCBtYXhSYWQyXSwgICAvLyBNYXBzIGRpcmVjdGx5IHRvIHBpeGVsIHNpemVzXG4gICAgY2xhbXA6IHRydWUgICAgICAgLy8gUHJldmVudHMgdmFsdWVzIG91dHNpZGUgZG9tYWluXG4gIH0sXG5cbiAgXG4gIHg6IHtcbiAgICBkb21haW46IFstMC41LCBuMiArIDAuNV0sXG4gICAgdGlja3M6IEFycmF5LmZyb20oe2xlbmd0aDogbjIgKyAxfSwgKF8sIGkpID0+IGkpLFxuICAgIHRpY2tGb3JtYXQ6IGQgPT4gZC50b1N0cmluZygpLFxuICAgIGxhYmVsOiBcIljigoFcIixcbiAgICBsYWJlbEFuY2hvcjogXCJjZW50ZXJcIixcbiAgICBsYWJlbE9mZnNldDogNTBcbiAgfSxcbiAgeToge1xuICAgIGRvbWFpbjogWy0wLjUsIG4yICsgMC41XSxcbiAgICB0aWNrczogQXJyYXkuZnJvbSh7bGVuZ3RoOiBuMiArIDF9LCAoXywgaSkgPT4gaSksXG4gICAgdGlja0Zvcm1hdDogZCA9PiBkLnRvU3RyaW5nKCksXG4gICAgbGFiZWw6IFwiWOKCglwiLFxuICAgIGxhYmVsQW5jaG9yOiBcImNlbnRlclwiLFxuICAgIGxhYmVsT2Zmc2V0OiA1MFxuICB9LFxuICBcbiAgbWFya3M6IFtcbiAgICAvLyBHcmlkIGxpbmVzXG4gICAgUGxvdC5ydWxlWChBcnJheS5mcm9tKHtsZW5ndGg6IG4yICsgMX0sIChfLCBpKSA9PiBpKSwge3N0cm9rZTogXCIjZjBmMGYwXCJ9KSxcbiAgICBQbG90LnJ1bGVZKEFycmF5LmZyb20oe2xlbmd0aDogbjIgKyAxfSwgKF8sIGkpID0+IGkpLCB7c3Ryb2tlOiBcIiNmMGYwZjBcIn0pLFxuICAgIFxuICAgIC8vIFByb2JhYmlsaXR5IGNpcmNsZXNcbiAgICBQbG90LmRvdChqb2ludERhdGEyLCB7XG4gICAgICB4OiBcIngxXCIsIFxuICAgICAgeTogXCJ4MlwiLCBcbiAgICAgIHI6IGQgPT4gTWF0aC5zcXJ0KGQucHJvYiAvIG1heFByb2IyKSAqIG1heFJhZDIsICAgXG4gICAgICBmaWxsOiBkID0+IGQuc2VsZWN0ZWQgPyBcInJlZFwiIDogXCJzdGVlbGJsdWVcIixcbiAgICAgIGZpbGxPcGFjaXR5OiAwLjcsXG4gICAgICBzdHJva2U6IFwiYmxhY2tcIixcbiAgICAgIHN0cm9rZVdpZHRoOiAwLjVcbiAgICB9KSxcbiAgICBcbiAgICAvLyBUb3AgbWFyZ2luYWwgaGlzdG9ncmFtIChY4oKBKVxuICAgIFBsb3QucmVjdChtYXJnaW5hbFgxMiwge1xuICAgICAgeDE6IGQgPT4gZC54MSAtIDAuMyxcbiAgICAgIHgyOiBkID0+IGQueDEgKyAwLjMsXG4gICAgICB5MTogbjIgKyAwLjU2ICsgbjIgKiAuMDYsXG4gICAgICB5MjogZCA9PiBuMiArIDAuNTYgKyBuMiAqIC4wNiArIChkLnByb2IgLyBtYXhNYXJnaW5hbFByb2IyKSAqIChuMiArIDEpICogMC4zLFxuICAgICAgZmlsbDogXCJzdGVlbGJsdWVcIixcbiAgICAgIGZpbGxPcGFjaXR5OiAwLjcsXG4gICAgICBzdHJva2U6IFwiYmxhY2tcIixcbiAgICAgIHN0cm9rZVdpZHRoOiAwLjVcbiAgICB9KSxcbiAgICBcbiAgICAvLyBSaWdodCBtYXJnaW5hbCBoaXN0b2dyYW0gKFjigoIpXG4gICAgUGxvdC5yZWN0KG1hcmdpbmFsWDIyLCB7XG4gICAgICB4MTogbjIgKyAwLjU2ICsgbjIgKiAuMDYsXG4gICAgICB4MjogZCA9PiBuMiArIDAuNTYgKyBuMiAqIC4wNiArIChkLnByb2IgLyBtYXhNYXJnaW5hbFByb2IyKSAqIChuMiArIDEpICogMC4zLFxuICAgICAgeTE6IGQgPT4gZC54MiAtIDAuMyxcbiAgICAgIHkyOiBkID0+IGQueDIgKyAwLjMsXG4gICAgICBmaWxsOiBcInN0ZWVsYmx1ZVwiLFxuICAgICAgZmlsbE9wYWNpdHk6IDAuNyxcbiAgICAgIHN0cm9rZTogXCJibGFja1wiLFxuICAgICAgc3Ryb2tlV2lkdGg6IDAuNVxuICAgIH0pLFxuICAgIFxuICAgIC8vIFRpdGxlXG4gICAgUGxvdC50ZXh0KFtcIkpvaW50IERpc3RyaWJ1dGlvbiBvZiBYID0gKFjigoEsIFjigoIpXCJdLCB7XG4gICAgICB4OiBuMi8yLCBcbiAgICAgIHk6IG4yICsgMC41ICsgKG4yICsgMSkgKiAuNDUsIFxuICAgICAgZm9udFNpemU6IDI0LCBcbiAgICAgIGZvbnRXZWlnaHQ6IFwiYm9sZFwiLFxuICAgICAgdGV4dEFuY2hvcjogXCJtaWRkbGVcIlxuICAgIH0pXG4gIF1cbn0pXG5cbmNvbmRpdGlvbmFsUGxvdDIgPSBQbG90LnBsb3Qoe1xuICB3aWR0aDogNDgwLFxuICBoZWlnaHQ6IDQ4MCxcbiAgbWFyZ2luVG9wOiAxNDAsXG4gIG1hcmdpbkxlZnQ6IDgwLFxuICBtYXJnaW5Cb3R0b206IDgwLFxuICBtYXJnaW5SaWdodDogMTIwLFxuICBzdHlsZTogeyBmb250U2l6ZTogXCIxNnB4XCIgfSxcbiAgXG4gIHI6IHtcbiAgICB0eXBlOiBcImxpbmVhclwiLFxuICAgIGRvbWFpbjogWzAsIG1heFJhZDJdLCAgLy8gRml4ZWQgZG9tYWluIGZyb20gMCB0byAyMFxuICAgIHJhbmdlOiBbMCwgbWF4UmFkMl0sICAgLy8gTWFwcyBkaXJlY3RseSB0byBwaXhlbCAgIHNpemVzICBcbiAgICBjbGFtcDogZmFsc2UgICAgICAgLy8gUHJldmVudHMgdmFsdWVzIG91dHNpZGUgZG9tYWluXG4gIH0sXG4gIHg6IHtcbiAgICBkb21haW46IFstMC41LCBuMiArIDAuNV0sXG4gICAgdGlja3M6IEFycmF5LmZyb20oe2xlbmd0aDogbjIgKyAxfSwgKF8sIGkpID0+IGkpLFxuICAgIHRpY2tGb3JtYXQ6IGQgPT4gZC50b1N0cmluZygpLFxuICAgIGxhYmVsOiBcIljigoFcIixcbiAgICBsYWJlbEFuY2hvcjogXCJjZW50ZXJcIixcbiAgICBsYWJlbE9mZnNldDogNTBcbiAgfSxcbiAgeToge1xuICAgIGRvbWFpbjogWy0wLjUsIG4yICsgMC41XSxcbiAgICB0aWNrczogQXJyYXkuZnJvbSh7bGVuZ3RoOiBuMiArIDF9LCAoXywgaSkgPT4gaSksXG4gICAgdGlja0Zvcm1hdDogZCA9PiBkLnRvU3RyaW5nKCksXG4gICAgbGFiZWw6IFwiWOKCglwiLFxuICAgIGxhYmVsQW5jaG9yOiBcImNlbnRlclwiLFxuICAgIGxhYmVsT2Zmc2V0OiA1MFxuICB9LFxuICBcbiAgbWFya3M6IFtcbiAgICAvLyBHcmlkIGxpbmVzXG4gICAgUGxvdC5ydWxlWChBcnJheS5mcm9tKHtsZW5ndGg6IG4yICsgMX0sIChfLCBpKSA9PiBpKSwge3N0cm9rZTogXCIjZjBmMGYwXCJ9KSxcbiAgICBQbG90LnJ1bGVZKEFycmF5LmZyb20oe2xlbmd0aDogbjIgKyAxfSwgKF8sIGkpID0+IGkpLCB7c3Ryb2tlOiBcIiNmMGYwZjBcIn0pLFxuICAgIFxuICAgIC8vIEFsbCBwb3NzaWJsZSBwb2ludHMgKGZhZGVkKVxuICAgIFBsb3QuZG90KGpvaW50RGF0YTIsIHtcbiAgICAgIHg6IFwieDFcIiwgXG4gICAgICB5OiBcIngyXCIsIFxuICAgICAgcjogMyxcbiAgICAgIGZpbGw6IFwibGlnaHRncmF5XCIsXG4gICAgICBmaWxsT3BhY2l0eTogMC4zXG4gICAgfSksXG4gICAgXG4gICAgLy8gQ29uZGl0aW9uYWwgcHJvYmFiaWxpdHkgY2lyY2xlc1xuICAgIFBsb3QuZG90KGNvbmRpdGlvbmFsRGF0YTIsIHtcbiAgICAgIHg6IFwieDFcIiwgXG4gICAgICB5OiBcIngyXCIsIFxuICAgICAgcjogZCA9PiBjb25kaXRpb25hbERhdGEyLmxlbmd0aCA+IDAgPyBNYXRoLnNxcnQoZC5jb25kUHJvYiAvIG1heENvbmRQcm9iMikgKiBtYXhSYWQyIDogNSxcbiAgICAgIGZpbGw6IFwicmVkXCIsXG4gICAgICBmaWxsT3BhY2l0eTogMC44LFxuICAgICAgc3Ryb2tlOiBcImJsYWNrXCIsXG4gICAgICBzdHJva2VXaWR0aDogMVxuICAgIH0pLFxuICAgIFxuICAgIC8vIFRvcCBjb25kaXRpb25hbCBtYXJnaW5hbCBoaXN0b2dyYW0gKFjigoEgfCBUID0gdClcbiAgICBQbG90LnJlY3QoY29uZGl0aW9uYWxNYXJnaW5hbFgxMiwge1xuICAgICAgeDE6IGQgPT4gZC54MSAtIDAuMyxcbiAgICAgIHgyOiBkID0+IGQueDEgKyAwLjMsXG4gICAgICB5MTogbjIgKyAwLjU2ICsgbjIgKiAuMDYsXG4gICAgICB5MjogZCA9PiBuMiArIDAuNTYgKyBuMiAqIC4wNiArIChkLnByb2IgLyBtYXhDb25kTWFyZ2luYWxQcm9iMikgKiAobjIgKyAxKSAqIDAuMyxcbiAgICAgIGZpbGw6IFwicmVkXCIsXG4gICAgICBmaWxsT3BhY2l0eTogMC43LFxuICAgICAgc3Ryb2tlOiBcImJsYWNrXCIsXG4gICAgICBzdHJva2VXaWR0aDogMC41XG4gICAgfSksXG4gICAgXG4gICAgLy8gUmlnaHQgY29uZGl0aW9uYWwgbWFyZ2luYWwgaGlzdG9ncmFtIChY4oKCIHwgUyA9IHMpXG4gICAgUGxvdC5yZWN0KGNvbmRpdGlvbmFsTWFyZ2luYWxYMjIsIHtcbiAgICAgIHgxOiBuMiArIDAuNTYgKyBuMiAqIC4wNixcbiAgICAgIHgyOiBkID0+IG4yICsgMC41NiArIG4yICogLjA2ICsgKGQucHJvYiAvIG1heENvbmRNYXJnaW5hbFByb2IyKSAqIChuMiArIDEpICogMC4zLFxuICAgICAgeTE6IGQgPT4gZC54MiAtIDAuMyxcbiAgICAgIHkyOiBkID0+IGQueDIgKyAwLjMsXG4gICAgICBmaWxsOiBcInJlZFwiLFxuICAgICAgZmlsbE9wYWNpdHk6IDAuNyxcbiAgICAgIHN0cm9rZTogXCJibGFja1wiLFxuICAgICAgc3Ryb2tlV2lkdGg6IDAuNVxuICAgIH0pLFxuICAgIFxuICAgIC8vIFRpdGxlXG4gICAgUGxvdC50ZXh0KFtgQ29uZGl0aW9uYWwgRGlzdHJpYnV0aW9uIFAoWCB8IFMgPSAoJHtzMV9zZWxlY3R9LCAke3MyX3NlbGVjdH0pKWBdLCB7XG4gICAgICB4OiBuMi8yLCBcbiAgICAgIHk6IG4yICsgMC41ICsgKG4yICsgMSkgKiAuNDUsIFxuICAgICAgZm9udFNpemU6IDI0LCBcbiAgICAgIGZvbnRXZWlnaHQ6IFwiYm9sZFwiLFxuICAgICAgdGV4dEFuY2hvcjogXCJtaWRkbGVcIlxuICAgIH0pXG4gIF1cbn0pXG5cbi8vIERpc3BsYXkgcGxvdHMgc2lkZSBieSBzaWRlXG5odG1sYDxkaXYgc3R5bGU9XCJkaXNwbGF5OiBmbGV4OyBnYXA6IDIwcHg7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGp1c3RpZnktY29udGVudDogY2VudGVyO1wiPlxuICAke2pvaW50UGxvdDJ9XG4gICR7Y29uZGl0aW9uYWxQbG90Mn1cbjwvZGl2PmBcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnbicpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCd0aGV0YScpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCd0X3NlbGVjdCcpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdkaXN0cmlidXRpb25UeXBlJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ24yJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3RoZXRhMicpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdTJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2Rpc3RyaWJ1dGlvblR5cGUyJykifV19
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../reader";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/stat210a\.berkeley\.edu\/fall-2025\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>